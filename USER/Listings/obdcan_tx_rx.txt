; generated by Component: ARM Compiler 5.06 update 5 (build 528) Tool: ArmCC [4d3621]
; commandline ArmCC [--list --split_sections --debug -c --asm --interleave -o..\obj\obdcan_tx_rx.o --asm_dir=.\Listings\ --list_dir=.\Listings\ --depend=..\obj\obdcan_tx_rx.d --cpu=Cortex-M3 --apcs=interwork -O0 --diag_suppress=9931 -I..\OBD -I..\SYSTEM -I..\USER -I..\LIB\inc -I..\UCOSII\CONFIG -I..\UCOSII\PORT -I..\UCOSII\CORE -I..\HAEDWARE -I..\GPS -I..\CDMA -I..\DEAL -I..\USB\CONFIG -I..\USB\STM32_USB-FS-Device_Driver\inc -I.\RTE\_Project -ID:\Keil_v5\ARM\PACK\ARM\CMSIS\5.2.0\CMSIS\Include -ID:\Keil_v5\ARM\PACK\Keil\STM32F1xx_DFP\2.2.0\Device\Include -D__MICROLIB -D__UVISION_VERSION=524 -D_RTE_ -DSTM32F10X_HD -DSTM32F10X_HD -DUSE_STDPERIPH_DRIVER --omf_browse=..\obj\obdcan_tx_rx.crf ..\OBD\OBDCAN_Tx_Rx.c]
                          THUMB

                          AREA ||i.CAN1_RX1_IRQHandler||, CODE, READONLY, ALIGN=2

                  CAN1_RX1_IRQHandler PROC
;;;38     
;;;39     void CAN1_RX1_IRQHandler(void )
000000  b570              PUSH     {r4-r6,lr}
;;;40     {
;;;41     	uint8_t err;
;;;42     	CanRxMsg* CAN1_RxMsg = Mem_malloc(sizeof(CanRxMsg));
000002  2014              MOVS     r0,#0x14
000004  f7fffffe          BL       Mem_malloc
000008  4605              MOV      r5,r0
;;;43     	
;;;44     	OSIntEnter();				//系统进入中断服务程序
00000a  f7fffffe          BL       OSIntEnter
;;;45     	
;;;46     	CAN_Receive(CAN1, CAN_FIFO1, CAN1_RxMsg);
00000e  462a              MOV      r2,r5
000010  2101              MOVS     r1,#1
000012  4810              LDR      r0,|L1.84|
000014  f7fffffe          BL       CAN_Receive
;;;47     
;;;48     	if(CAN1_RxMsg->ExtId != varOperation.canRxId)//扔给J1939任务处理
000018  490f              LDR      r1,|L1.88|
00001a  6868              LDR      r0,[r5,#4]
00001c  f8d1108c          LDR      r1,[r1,#0x8c]  ; varOperation
000020  4288              CMP      r0,r1
000022  d00a              BEQ      |L1.58|
;;;49     	{
;;;50     		err = OSQPost(canJ1939Q,CAN1_RxMsg);
000024  4629              MOV      r1,r5
000026  480d              LDR      r0,|L1.92|
000028  6800              LDR      r0,[r0,#0]  ; canJ1939Q
00002a  f7fffffe          BL       OSQPost
00002e  4604              MOV      r4,r0
;;;51     		if(err != OS_ERR_NONE)
000030  b16c              CBZ      r4,|L1.78|
;;;52     			Mem_free(CAN1_RxMsg);
000032  4628              MOV      r0,r5
000034  f7fffffe          BL       Mem_free
000038  e009              B        |L1.78|
                  |L1.58|
;;;53     	}else 
;;;54     	{
;;;55     		err = OSQPost(canRecieveQ,CAN1_RxMsg);
00003a  4629              MOV      r1,r5
00003c  4808              LDR      r0,|L1.96|
00003e  6800              LDR      r0,[r0,#0]  ; canRecieveQ
000040  f7fffffe          BL       OSQPost
000044  4604              MOV      r4,r0
;;;56     		if(err != OS_ERR_NONE)
000046  b114              CBZ      r4,|L1.78|
;;;57     			Mem_free(CAN1_RxMsg);
000048  4628              MOV      r0,r5
00004a  f7fffffe          BL       Mem_free
                  |L1.78|
;;;58     	}
;;;59     	OSIntExit();  //中断服务结束，系统进行任务调度
00004e  f7fffffe          BL       OSIntExit
;;;60     }
000052  bd70              POP      {r4-r6,pc}
;;;61     
                          ENDP

                  |L1.84|
                          DCD      0x40006400
                  |L1.88|
                          DCD      varOperation
                  |L1.92|
                          DCD      canJ1939Q
                  |L1.96|
                          DCD      canRecieveQ

                          AREA ||i.OBD_CAN_SendData||, CODE, READONLY, ALIGN=2

                  OBD_CAN_SendData PROC
;;;8      static CanTxMsg TxMessage;
;;;9      void OBD_CAN_SendData(u32 canId,u32 ide,u8* pdat)
000000  b5f8              PUSH     {r3-r7,lr}
;;;10     {
000002  4605              MOV      r5,r0
000004  460e              MOV      r6,r1
000006  4614              MOV      r4,r2
;;;11     	u8 err;
;;;12     	OSMutexPend(CANSendMutex,0,&err);     //提高优先级，独占CAN
000008  466a              MOV      r2,sp
00000a  2100              MOVS     r1,#0
00000c  4813              LDR      r0,|L2.92|
00000e  6800              LDR      r0,[r0,#0]  ; CANSendMutex
000010  f7fffffe          BL       OSMutexPend
;;;13     			
;;;14     	TxMessage.StdId = canId;
000014  4812              LDR      r0,|L2.96|
000016  6005              STR      r5,[r0,#0]  ; TxMessage
;;;15     	TxMessage.ExtId = canId;  //扩展帧
000018  6045              STR      r5,[r0,#4]  ; TxMessage
;;;16     	
;;;17     	TxMessage.IDE = ide;
00001a  4601              MOV      r1,r0
00001c  720e              STRB     r6,[r1,#8]
;;;18     	TxMessage.RTR = CAN_RTR_DATA;
00001e  2000              MOVS     r0,#0
000020  7248              STRB     r0,[r1,#9]
;;;19     	TxMessage.DLC = 8;//数据长度
000022  2008              MOVS     r0,#8
000024  7288              STRB     r0,[r1,#0xa]
;;;20     	
;;;21     	TxMessage.Data[0] = pdat[0];
000026  7820              LDRB     r0,[r4,#0]
000028  72c8              STRB     r0,[r1,#0xb]
;;;22     	TxMessage.Data[1] = pdat[1];
00002a  7861              LDRB     r1,[r4,#1]
00002c  480c              LDR      r0,|L2.96|
00002e  7301              STRB     r1,[r0,#0xc]
;;;23     	TxMessage.Data[2] = pdat[2];
000030  78a1              LDRB     r1,[r4,#2]
000032  7341              STRB     r1,[r0,#0xd]
;;;24     	TxMessage.Data[3] = pdat[3];
000034  78e1              LDRB     r1,[r4,#3]
000036  7381              STRB     r1,[r0,#0xe]
;;;25     	TxMessage.Data[4] = pdat[4];
000038  7921              LDRB     r1,[r4,#4]
00003a  73c1              STRB     r1,[r0,#0xf]
;;;26     	TxMessage.Data[5] = pdat[5];
00003c  7961              LDRB     r1,[r4,#5]
00003e  7401              STRB     r1,[r0,#0x10]
;;;27     	TxMessage.Data[6] = pdat[6];
000040  79a1              LDRB     r1,[r4,#6]
000042  7441              STRB     r1,[r0,#0x11]
;;;28     	TxMessage.Data[7] = pdat[7];
000044  79e1              LDRB     r1,[r4,#7]
000046  7481              STRB     r1,[r0,#0x12]
;;;29     	
;;;30     	CAN_Transmit(CAN1,&TxMessage);
000048  4601              MOV      r1,r0
00004a  4806              LDR      r0,|L2.100|
00004c  f7fffffe          BL       CAN_Transmit
;;;31     	
;;;32     	OSMutexPost(CANSendMutex);
000050  4802              LDR      r0,|L2.92|
000052  6800              LDR      r0,[r0,#0]  ; CANSendMutex
000054  f7fffffe          BL       OSMutexPost
;;;33     }
000058  bdf8              POP      {r3-r7,pc}
;;;34     
                          ENDP

00005a  0000              DCW      0x0000
                  |L2.92|
                          DCD      CANSendMutex
                  |L2.96|
                          DCD      TxMessage
                  |L2.100|
                          DCD      0x40006400

                          AREA ||.bss||, DATA, NOINIT, ALIGN=2

                  TxMessage
                          %        20

;*** Start embedded assembler ***

#line 1 "..\\OBD\\OBDCAN_Tx_Rx.c"
	AREA ||.rev16_text||, CODE
	THUMB
	EXPORT |__asm___14_OBDCAN_Tx_Rx_c_55f03bcd____REV16|
#line 465 "D:\\Keil_v5\\ARM\\PACK\\ARM\\CMSIS\\5.2.0\\CMSIS\\Include\\cmsis_armcc.h"
|__asm___14_OBDCAN_Tx_Rx_c_55f03bcd____REV16| PROC
#line 466

 rev16 r0, r0
 bx lr
	ENDP
	AREA ||.revsh_text||, CODE
	THUMB
	EXPORT |__asm___14_OBDCAN_Tx_Rx_c_55f03bcd____REVSH|
#line 480
|__asm___14_OBDCAN_Tx_Rx_c_55f03bcd____REVSH| PROC
#line 481

 revsh r0, r0
 bx lr
	ENDP
	AREA ||.rrx_text||, CODE
	THUMB
	EXPORT |__asm___14_OBDCAN_Tx_Rx_c_55f03bcd____RRX|
#line 667
|__asm___14_OBDCAN_Tx_Rx_c_55f03bcd____RRX| PROC
#line 668

 rrx r0, r0
 bx lr
	ENDP

;*** End   embedded assembler ***
