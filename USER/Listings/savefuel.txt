; generated by Component: ARM Compiler 5.06 update 5 (build 528) Tool: ArmCC [4d3621]
; commandline ArmCC [--list --split_sections --debug -c --asm --interleave -o..\obj\savefuel.o --asm_dir=.\Listings\ --list_dir=.\Listings\ --depend=..\obj\savefuel.d --cpu=Cortex-M3 --apcs=interwork -O0 --diag_suppress=9931 -I..\OBD -I..\SYSTEM -I..\USER -I..\LIB\inc -I..\UCOSII\CONFIG -I..\UCOSII\PORT -I..\UCOSII\CORE -I..\HAEDWARE -I..\GPS -I..\CDMA -I..\DEAL -I..\USB\CONFIG -I..\USB\STM32_USB-FS-Device_Driver\inc -I..\CORE -I.\RTE\_Project -ID:\Keil_v5\ARM\PACK\ARM\CMSIS\5.2.0\CMSIS\Include -ID:\Keil_v5\ARM\PACK\Keil\STM32F1xx_DFP\2.2.0\Device\Include -D__MICROLIB -D__UVISION_VERSION=524 -D_RTE_ -DSTM32F10X_HD -DSTM32F10X_HD -DUSE_STDPERIPH_DRIVER --omf_browse=..\obj\savefuel.crf ..\OBD\saveFuel.c]
                          THUMB

                          AREA ||i.CanErrDetec||, CODE, READONLY, ALIGN=2

                  CanErrDetec PROC
;;;107    ========================================================================*/
;;;108    u8 CanErrDetec(u16 ErrDebT,u8 Signal)
000000  4602              MOV      r2,r0
;;;109    {
;;;110       static u16 CanErrCnt = 150;
;;;111        
;;;112       if(CanErrCnt<65530)CanErrCnt++;
000002  4818              LDR      r0,|L1.100|
000004  8800              LDRH     r0,[r0,#0]  ; CanErrCnt
000006  f64f73fa          MOV      r3,#0xfffa
00000a  4298              CMP      r0,r3
00000c  da04              BGE      |L1.24|
00000e  4815              LDR      r0,|L1.100|
000010  8800              LDRH     r0,[r0,#0]  ; CanErrCnt
000012  1c40              ADDS     r0,r0,#1
000014  4b13              LDR      r3,|L1.100|
000016  8018              STRH     r0,[r3,#0]
                  |L1.24|
;;;113       if(Signal==1&&CANr1==1&&CANr2==1 && CANr3==1 && CANr4==1 && CANr5==1 &&CANr6==1){
000018  2901              CMP      r1,#1
00001a  d11a              BNE      |L1.82|
00001c  4812              LDR      r0,|L1.104|
00001e  7800              LDRB     r0,[r0,#0]  ; CANr1
000020  2801              CMP      r0,#1
000022  d116              BNE      |L1.82|
000024  4811              LDR      r0,|L1.108|
000026  7800              LDRB     r0,[r0,#0]  ; CANr2
000028  2801              CMP      r0,#1
00002a  d112              BNE      |L1.82|
00002c  4810              LDR      r0,|L1.112|
00002e  7800              LDRB     r0,[r0,#0]  ; CANr3
000030  2801              CMP      r0,#1
000032  d10e              BNE      |L1.82|
000034  480f              LDR      r0,|L1.116|
000036  7800              LDRB     r0,[r0,#0]  ; CANr4
000038  2801              CMP      r0,#1
00003a  d10a              BNE      |L1.82|
00003c  480e              LDR      r0,|L1.120|
00003e  7800              LDRB     r0,[r0,#0]  ; CANr5
000040  2801              CMP      r0,#1
000042  d106              BNE      |L1.82|
000044  480d              LDR      r0,|L1.124|
000046  7800              LDRB     r0,[r0,#0]  ; CANr6
000048  2801              CMP      r0,#1
00004a  d102              BNE      |L1.82|
;;;114         CanErrCnt = 0; 
00004c  2000              MOVS     r0,#0
00004e  4b05              LDR      r3,|L1.100|
000050  8018              STRH     r0,[r3,#0]
                  |L1.82|
;;;115       }
;;;116       if(CanErrCnt>=ErrDebT)
000052  4804              LDR      r0,|L1.100|
000054  8800              LDRH     r0,[r0,#0]  ; CanErrCnt
000056  4290              CMP      r0,r2
000058  db01              BLT      |L1.94|
;;;117    	   return 0;
00005a  2000              MOVS     r0,#0
                  |L1.92|
;;;118       else 
;;;119    	   return 1;
;;;120    
;;;121    }
00005c  4770              BX       lr
                  |L1.94|
00005e  2001              MOVS     r0,#1                 ;119
000060  e7fc              B        |L1.92|
;;;122    u8 CanErrDetec7(u16 ErrDebT,u8 Signal)
                          ENDP

000062  0000              DCW      0x0000
                  |L1.100|
                          DCD      CanErrCnt
                  |L1.104|
                          DCD      CANr1
                  |L1.108|
                          DCD      CANr2
                  |L1.112|
                          DCD      CANr3
                  |L1.116|
                          DCD      CANr4
                  |L1.120|
                          DCD      CANr5
                  |L1.124|
                          DCD      CANr6

                          AREA ||i.CanErrDetec17||, CODE, READONLY, ALIGN=2

                  CanErrDetec17 PROC
;;;133    }
;;;134    u8 CanErrDetec17(u16 ErrDebT,u8 Signal)
000000  4602              MOV      r2,r0
;;;135    {
;;;136       static u16 CanErrCnt = 150;
;;;137        
;;;138       if(CanErrCnt<65530)CanErrCnt++;
000002  4818              LDR      r0,|L2.100|
000004  8800              LDRH     r0,[r0,#0]  ; CanErrCnt
000006  f64f73fa          MOV      r3,#0xfffa
00000a  4298              CMP      r0,r3
00000c  da04              BGE      |L2.24|
00000e  4815              LDR      r0,|L2.100|
000010  8800              LDRH     r0,[r0,#0]  ; CanErrCnt
000012  1c40              ADDS     r0,r0,#1
000014  4b13              LDR      r3,|L2.100|
000016  8018              STRH     r0,[r3,#0]
                  |L2.24|
;;;139       if(Signal == 1 && CANr1 == 1&&CANr2 == 1 && CANr3==1&&CANr4==1&&CANr5==1&&CANr6==1){
000018  2901              CMP      r1,#1
00001a  d11a              BNE      |L2.82|
00001c  4812              LDR      r0,|L2.104|
00001e  7800              LDRB     r0,[r0,#0]  ; CANr1
000020  2801              CMP      r0,#1
000022  d116              BNE      |L2.82|
000024  4811              LDR      r0,|L2.108|
000026  7800              LDRB     r0,[r0,#0]  ; CANr2
000028  2801              CMP      r0,#1
00002a  d112              BNE      |L2.82|
00002c  4810              LDR      r0,|L2.112|
00002e  7800              LDRB     r0,[r0,#0]  ; CANr3
000030  2801              CMP      r0,#1
000032  d10e              BNE      |L2.82|
000034  480f              LDR      r0,|L2.116|
000036  7800              LDRB     r0,[r0,#0]  ; CANr4
000038  2801              CMP      r0,#1
00003a  d10a              BNE      |L2.82|
00003c  480e              LDR      r0,|L2.120|
00003e  7800              LDRB     r0,[r0,#0]  ; CANr5
000040  2801              CMP      r0,#1
000042  d106              BNE      |L2.82|
000044  480d              LDR      r0,|L2.124|
000046  7800              LDRB     r0,[r0,#0]  ; CANr6
000048  2801              CMP      r0,#1
00004a  d102              BNE      |L2.82|
;;;140         CanErrCnt = 0; 
00004c  2000              MOVS     r0,#0
00004e  4b05              LDR      r3,|L2.100|
000050  8018              STRH     r0,[r3,#0]
                  |L2.82|
;;;141       }     
;;;142       if(CanErrCnt >= ErrDebT)return 0;
000052  4804              LDR      r0,|L2.100|
000054  8800              LDRH     r0,[r0,#0]  ; CanErrCnt
000056  4290              CMP      r0,r2
000058  db01              BLT      |L2.94|
00005a  2000              MOVS     r0,#0
                  |L2.92|
;;;143       else return 1;
;;;144    }
00005c  4770              BX       lr
                  |L2.94|
00005e  2001              MOVS     r0,#1                 ;143
000060  e7fc              B        |L2.92|
;;;145    
                          ENDP

000062  0000              DCW      0x0000
                  |L2.100|
                          DCD      |symbol_number.45|
                  |L2.104|
                          DCD      CANr1
                  |L2.108|
                          DCD      CANr2
                  |L2.112|
                          DCD      CANr3
                  |L2.116|
                          DCD      CANr4
                  |L2.120|
                          DCD      CANr5
                  |L2.124|
                          DCD      CANr6

                          AREA ||i.CanErrDetec7||, CODE, READONLY, ALIGN=2

                  CanErrDetec7 PROC
;;;121    }
;;;122    u8 CanErrDetec7(u16 ErrDebT,u8 Signal)
000000  4602              MOV      r2,r0
;;;123    {
;;;124       static u16 CanErrCnt = 150;
;;;125        
;;;126       if(CanErrCnt<65530)CanErrCnt++;
000002  4818              LDR      r0,|L3.100|
000004  8800              LDRH     r0,[r0,#0]  ; CanErrCnt
000006  f64f73fa          MOV      r3,#0xfffa
00000a  4298              CMP      r0,r3
00000c  da04              BGE      |L3.24|
00000e  4815              LDR      r0,|L3.100|
000010  8800              LDRH     r0,[r0,#0]  ; CanErrCnt
000012  1c40              ADDS     r0,r0,#1
000014  4b13              LDR      r3,|L3.100|
000016  8018              STRH     r0,[r3,#0]
                  |L3.24|
;;;127       if(Signal==1&&CANr1==1&&CANr2==1&&CANr3==1&&CANr4==1&&CANr5==1&&CANr6==1){
000018  2901              CMP      r1,#1
00001a  d11a              BNE      |L3.82|
00001c  4812              LDR      r0,|L3.104|
00001e  7800              LDRB     r0,[r0,#0]  ; CANr1
000020  2801              CMP      r0,#1
000022  d116              BNE      |L3.82|
000024  4811              LDR      r0,|L3.108|
000026  7800              LDRB     r0,[r0,#0]  ; CANr2
000028  2801              CMP      r0,#1
00002a  d112              BNE      |L3.82|
00002c  4810              LDR      r0,|L3.112|
00002e  7800              LDRB     r0,[r0,#0]  ; CANr3
000030  2801              CMP      r0,#1
000032  d10e              BNE      |L3.82|
000034  480f              LDR      r0,|L3.116|
000036  7800              LDRB     r0,[r0,#0]  ; CANr4
000038  2801              CMP      r0,#1
00003a  d10a              BNE      |L3.82|
00003c  480e              LDR      r0,|L3.120|
00003e  7800              LDRB     r0,[r0,#0]  ; CANr5
000040  2801              CMP      r0,#1
000042  d106              BNE      |L3.82|
000044  480d              LDR      r0,|L3.124|
000046  7800              LDRB     r0,[r0,#0]  ; CANr6
000048  2801              CMP      r0,#1
00004a  d102              BNE      |L3.82|
;;;128         CanErrCnt = 0; 
00004c  2000              MOVS     r0,#0
00004e  4b05              LDR      r3,|L3.100|
000050  8018              STRH     r0,[r3,#0]
                  |L3.82|
;;;129       }     
;;;130       if(CanErrCnt>=ErrDebT)return 0;
000052  4804              LDR      r0,|L3.100|
000054  8800              LDRH     r0,[r0,#0]  ; CanErrCnt
000056  4290              CMP      r0,r2
000058  db01              BLT      |L3.94|
00005a  2000              MOVS     r0,#0
                  |L3.92|
;;;131       else return 1;
;;;132    
;;;133    }
00005c  4770              BX       lr
                  |L3.94|
00005e  2001              MOVS     r0,#1                 ;131
000060  e7fc              B        |L3.92|
;;;134    u8 CanErrDetec17(u16 ErrDebT,u8 Signal)
                          ENDP

000062  0000              DCW      0x0000
                  |L3.100|
                          DCD      |symbol_number.44|
                  |L3.104|
                          DCD      CANr1
                  |L3.108|
                          DCD      CANr2
                  |L3.112|
                          DCD      CANr3
                  |L3.116|
                          DCD      CANr4
                  |L3.120|
                          DCD      CANr5
                  |L3.124|
                          DCD      CANr6

                          AREA ||i.CoEng_rloadCal||, CODE, READONLY, ALIGN=2

                  CoEng_rloadCal PROC
;;;400    
;;;401    void CoEng_rloadCal(void)  //100ms   平均负荷率计算, 平均转速计算, 平均油门计算, 100ms *200 = 20s
000000  b510              PUSH     {r4,lr}
;;;402    {
;;;403         static u8  i, j;  
;;;404    //----------------------------------------------------------------------------------------   
;;;405    	for(i=0;i<199;i++)
000002  2000              MOVS     r0,#0
000004  4977              LDR      r1,|L4.484|
000006  7008              STRB     r0,[r1,#0]
000008  e00c              B        |L4.36|
                  |L4.10|
;;;406    	{
;;;407    		CoEng_rtrqInr100ms[i]=CoEng_rtrqInr100ms[i+1];
00000a  4977              LDR      r1,|L4.488|
00000c  4875              LDR      r0,|L4.484|
00000e  7800              LDRB     r0,[r0,#0]  ; i
000010  1c40              ADDS     r0,r0,#1
000012  5c08              LDRB     r0,[r1,r0]
000014  4a73              LDR      r2,|L4.484|
000016  7812              LDRB     r2,[r2,#0]  ; i
000018  5488              STRB     r0,[r1,r2]
00001a  4872              LDR      r0,|L4.484|
00001c  7800              LDRB     r0,[r0,#0]            ;405  ; i
00001e  1c40              ADDS     r0,r0,#1              ;405
000020  4970              LDR      r1,|L4.484|
000022  7008              STRB     r0,[r1,#0]            ;405
                  |L4.36|
000024  486f              LDR      r0,|L4.484|
000026  7800              LDRB     r0,[r0,#0]            ;405  ; i
000028  28c7              CMP      r0,#0xc7              ;405
00002a  dbee              BLT      |L4.10|
;;;408    	}
;;;409    	CoEng_rtrqInr100ms[199]=Curr_trq;    //当前扭矩            
00002c  486f              LDR      r0,|L4.492|
00002e  7800              LDRB     r0,[r0,#0]  ; Curr_trq
000030  496d              LDR      r1,|L4.488|
000032  f88100c7          STRB     r0,[r1,#0xc7]
;;;410    	Coeng_rtrqInrSum=0;
000036  2000              MOVS     r0,#0
000038  496d              LDR      r1,|L4.496|
00003a  6008              STR      r0,[r1,#0]  ; Coeng_rtrqInrSum
;;;411    	for(j=0;j<200;j++)
00003c  496d              LDR      r1,|L4.500|
00003e  7008              STRB     r0,[r1,#0]
000040  e00d              B        |L4.94|
                  |L4.66|
;;;412    	{
;;;413    		Coeng_rtrqInrSum=Coeng_rtrqInrSum+CoEng_rtrqInr100ms[j];
000042  4869              LDR      r0,|L4.488|
000044  496b              LDR      r1,|L4.500|
000046  7809              LDRB     r1,[r1,#0]  ; j
000048  5c40              LDRB     r0,[r0,r1]
00004a  4969              LDR      r1,|L4.496|
00004c  6809              LDR      r1,[r1,#0]  ; Coeng_rtrqInrSum
00004e  4408              ADD      r0,r0,r1
000050  4967              LDR      r1,|L4.496|
000052  6008              STR      r0,[r1,#0]  ; Coeng_rtrqInrSum
000054  4867              LDR      r0,|L4.500|
000056  7800              LDRB     r0,[r0,#0]            ;411  ; j
000058  1c40              ADDS     r0,r0,#1              ;411
00005a  4966              LDR      r1,|L4.500|
00005c  7008              STRB     r0,[r1,#0]            ;411
                  |L4.94|
00005e  4865              LDR      r0,|L4.500|
000060  7800              LDRB     r0,[r0,#0]            ;411  ; j
000062  28c8              CMP      r0,#0xc8              ;411
000064  dbed              BLT      |L4.66|
;;;414    	}
;;;415    	CoEng_rtrqInrAvg=Coeng_rtrqInrSum/200;  //20s平均负荷计算%
000066  4862              LDR      r0,|L4.496|
000068  6800              LDR      r0,[r0,#0]  ; Coeng_rtrqInrSum
00006a  21c8              MOVS     r1,#0xc8
00006c  fb90f0f1          SDIV     r0,r0,r1
000070  4961              LDR      r1,|L4.504|
000072  6008              STR      r0,[r1,#0]  ; CoEng_rtrqInrAvg
;;;416    	
;;;417    //-----------------------------------------------------------------------------------------	
;;;418    	
;;;419    	for(i=0;i<100;i++)
000074  2000              MOVS     r0,#0
000076  495b              LDR      r1,|L4.484|
000078  7008              STRB     r0,[r1,#0]
00007a  e00c              B        |L4.150|
                  |L4.124|
;;;420    	{
;;;421    		CoEng_rDrvLoad100ms[i] =CoEng_rDrvLoad100ms[i+1];
00007c  495f              LDR      r1,|L4.508|
00007e  4859              LDR      r0,|L4.484|
000080  7800              LDRB     r0,[r0,#0]  ; i
000082  1c40              ADDS     r0,r0,#1
000084  5c08              LDRB     r0,[r1,r0]
000086  4a57              LDR      r2,|L4.484|
000088  7812              LDRB     r2,[r2,#0]  ; i
00008a  5488              STRB     r0,[r1,r2]
00008c  4855              LDR      r0,|L4.484|
00008e  7800              LDRB     r0,[r0,#0]            ;419  ; i
000090  1c40              ADDS     r0,r0,#1              ;419
000092  4954              LDR      r1,|L4.484|
000094  7008              STRB     r0,[r1,#0]            ;419
                  |L4.150|
000096  4853              LDR      r0,|L4.484|
000098  7800              LDRB     r0,[r0,#0]            ;419  ; i
00009a  2864              CMP      r0,#0x64              ;419
00009c  dbee              BLT      |L4.124|
;;;422    	}
;;;423    	CoEng_rDrvLoad100ms[99] = CoEng_rDrvLoad;
00009e  4858              LDR      r0,|L4.512|
0000a0  7800              LDRB     r0,[r0,#0]  ; CoEng_rDrvLoad
0000a2  4956              LDR      r1,|L4.508|
0000a4  f8810063          STRB     r0,[r1,#0x63]
;;;424    	Coeng_rDrvLoadSum=0;                                           //10s平均驾驶员需求扭矩%
0000a8  2000              MOVS     r0,#0
0000aa  4956              LDR      r1,|L4.516|
0000ac  6008              STR      r0,[r1,#0]  ; Coeng_rDrvLoadSum
;;;425    	for(j=0;j<100;j++)
0000ae  4951              LDR      r1,|L4.500|
0000b0  7008              STRB     r0,[r1,#0]
0000b2  e00d              B        |L4.208|
                  |L4.180|
;;;426    	{
;;;427    		Coeng_rDrvLoadSum = Coeng_rDrvLoadSum + CoEng_rDrvLoad100ms[j];
0000b4  4851              LDR      r0,|L4.508|
0000b6  494f              LDR      r1,|L4.500|
0000b8  7809              LDRB     r1,[r1,#0]  ; j
0000ba  5c40              LDRB     r0,[r0,r1]
0000bc  4951              LDR      r1,|L4.516|
0000be  6809              LDR      r1,[r1,#0]  ; Coeng_rDrvLoadSum
0000c0  4408              ADD      r0,r0,r1
0000c2  4950              LDR      r1,|L4.516|
0000c4  6008              STR      r0,[r1,#0]  ; Coeng_rDrvLoadSum
0000c6  484b              LDR      r0,|L4.500|
0000c8  7800              LDRB     r0,[r0,#0]            ;425  ; j
0000ca  1c40              ADDS     r0,r0,#1              ;425
0000cc  4949              LDR      r1,|L4.500|
0000ce  7008              STRB     r0,[r1,#0]            ;425
                  |L4.208|
0000d0  4848              LDR      r0,|L4.500|
0000d2  7800              LDRB     r0,[r0,#0]            ;425  ; j
0000d4  2864              CMP      r0,#0x64              ;425
0000d6  dbed              BLT      |L4.180|
;;;428    	}
;;;429      CoEng_rDrv10Load = Coeng_rDrvLoadSum/100;	
0000d8  484a              LDR      r0,|L4.516|
0000da  6800              LDR      r0,[r0,#0]  ; Coeng_rDrvLoadSum
0000dc  2164              MOVS     r1,#0x64
0000de  fb90f4f1          SDIV     r4,r0,r1
0000e2  4620              MOV      r0,r4
0000e4  f7fffffe          BL       __aeabi_i2f
0000e8  4947              LDR      r1,|L4.520|
0000ea  6008              STR      r0,[r1,#0]  ; CoEng_rDrv10Load
;;;430    	
;;;431    //------------------------------------------------------------------------------------------	
;;;432    	for(i=0;i<199;i++)
0000ec  2000              MOVS     r0,#0
0000ee  493d              LDR      r1,|L4.484|
0000f0  7008              STRB     r0,[r1,#0]
0000f2  e00e              B        |L4.274|
                  |L4.244|
;;;433    	{
;;;434    		Eng_nAvg100ms[i]=Eng_nAvg100ms[i+1];
0000f4  4945              LDR      r1,|L4.524|
0000f6  483b              LDR      r0,|L4.484|
0000f8  7800              LDRB     r0,[r0,#0]  ; i
0000fa  1c40              ADDS     r0,r0,#1
0000fc  f8510020          LDR      r0,[r1,r0,LSL #2]
000100  4a38              LDR      r2,|L4.484|
000102  7812              LDRB     r2,[r2,#0]  ; i
000104  f8410022          STR      r0,[r1,r2,LSL #2]
000108  4836              LDR      r0,|L4.484|
00010a  7800              LDRB     r0,[r0,#0]            ;432  ; i
00010c  1c40              ADDS     r0,r0,#1              ;432
00010e  4935              LDR      r1,|L4.484|
000110  7008              STRB     r0,[r1,#0]            ;432
                  |L4.274|
000112  4834              LDR      r0,|L4.484|
000114  7800              LDRB     r0,[r0,#0]            ;432  ; i
000116  28c7              CMP      r0,#0xc7              ;432
000118  dbec              BLT      |L4.244|
;;;435    	}
;;;436    	Eng_nAvg100ms[199]=Eng_nAvg;
00011a  483d              LDR      r0,|L4.528|
00011c  6800              LDR      r0,[r0,#0]  ; Eng_nAvg
00011e  f7fffffe          BL       __aeabi_f2iz
000122  493a              LDR      r1,|L4.524|
000124  f8c1031c          STR      r0,[r1,#0x31c]  ; Eng_nAvg100ms
;;;437    	Eng_nAvgSum=0;
000128  2000              MOVS     r0,#0
00012a  493a              LDR      r1,|L4.532|
00012c  6008              STR      r0,[r1,#0]  ; Eng_nAvgSum
;;;438    	for(j=0;j<200;j++)                                            //20s发动机平均转速
00012e  4931              LDR      r1,|L4.500|
000130  7008              STRB     r0,[r1,#0]
000132  e00e              B        |L4.338|
                  |L4.308|
;;;439    	{
;;;440    		Eng_nAvgSum = Eng_nAvgSum+Eng_nAvg100ms[j];
000134  4835              LDR      r0,|L4.524|
000136  492f              LDR      r1,|L4.500|
000138  7809              LDRB     r1,[r1,#0]  ; j
00013a  f8500021          LDR      r0,[r0,r1,LSL #2]
00013e  4935              LDR      r1,|L4.532|
000140  6809              LDR      r1,[r1,#0]  ; Eng_nAvgSum
000142  4408              ADD      r0,r0,r1
000144  4933              LDR      r1,|L4.532|
000146  6008              STR      r0,[r1,#0]  ; Eng_nAvgSum
000148  482a              LDR      r0,|L4.500|
00014a  7800              LDRB     r0,[r0,#0]            ;438  ; j
00014c  1c40              ADDS     r0,r0,#1              ;438
00014e  4929              LDR      r1,|L4.500|
000150  7008              STRB     r0,[r1,#0]            ;438
                  |L4.338|
000152  4828              LDR      r0,|L4.500|
000154  7800              LDRB     r0,[r0,#0]            ;438  ; j
000156  28c8              CMP      r0,#0xc8              ;438
000158  dbec              BLT      |L4.308|
;;;441    	}
;;;442    	Eng_nAvg20=Eng_nAvgSum/200;
00015a  482e              LDR      r0,|L4.532|
00015c  6800              LDR      r0,[r0,#0]  ; Eng_nAvgSum
00015e  21c8              MOVS     r1,#0xc8
000160  fb90f0f1          SDIV     r0,r0,r1
000164  492c              LDR      r1,|L4.536|
000166  6008              STR      r0,[r1,#0]  ; Eng_nAvg20
;;;443    //------------------------------------------------------------------------------------------	
;;;444    	for(i=0;i<29;i++)
000168  2000              MOVS     r0,#0
00016a  491e              LDR      r1,|L4.484|
00016c  7008              STRB     r0,[r1,#0]
00016e  e00f              B        |L4.400|
                  |L4.368|
;;;445    	{
;;;446    		Accped_r100ms[i]=Accped_r100ms[i+1];
000170  492a              LDR      r1,|L4.540|
000172  481c              LDR      r0,|L4.484|
000174  7800              LDRB     r0,[r0,#0]  ; i
000176  1c40              ADDS     r0,r0,#1
000178  f8511020          LDR      r1,[r1,r0,LSL #2]
00017c  4827              LDR      r0,|L4.540|
00017e  4a19              LDR      r2,|L4.484|
000180  7812              LDRB     r2,[r2,#0]  ; i
000182  f8401022          STR      r1,[r0,r2,LSL #2]
000186  4817              LDR      r0,|L4.484|
000188  7800              LDRB     r0,[r0,#0]            ;444  ; i
00018a  1c40              ADDS     r0,r0,#1              ;444
00018c  4915              LDR      r1,|L4.484|
00018e  7008              STRB     r0,[r1,#0]            ;444
                  |L4.400|
000190  4814              LDR      r0,|L4.484|
000192  7800              LDRB     r0,[r0,#0]            ;444  ; i
000194  281d              CMP      r0,#0x1d              ;444
000196  dbeb              BLT      |L4.368|
;;;447    	}
;;;448    	Accped_r100ms[29]=Accped_rint;
000198  4821              LDR      r0,|L4.544|
00019a  6800              LDR      r0,[r0,#0]  ; Accped_rint
00019c  491f              LDR      r1,|L4.540|
00019e  6748              STR      r0,[r1,#0x74]  ; Accped_r100ms
;;;449    	Accped_rSum=0;                                                //3s平均油门踏板
0001a0  2000              MOVS     r0,#0
0001a2  4920              LDR      r1,|L4.548|
0001a4  6008              STR      r0,[r1,#0]  ; Accped_rSum
;;;450    	for(j=0;j<30;j++)
0001a6  4913              LDR      r1,|L4.500|
0001a8  7008              STRB     r0,[r1,#0]
0001aa  e00e              B        |L4.458|
                  |L4.428|
;;;451    	{
;;;452    		Accped_rSum=Accped_rSum+Accped_r100ms[j];
0001ac  481b              LDR      r0,|L4.540|
0001ae  4911              LDR      r1,|L4.500|
0001b0  7809              LDRB     r1,[r1,#0]  ; j
0001b2  f8500021          LDR      r0,[r0,r1,LSL #2]
0001b6  491b              LDR      r1,|L4.548|
0001b8  6809              LDR      r1,[r1,#0]  ; Accped_rSum
0001ba  4408              ADD      r0,r0,r1
0001bc  4919              LDR      r1,|L4.548|
0001be  6008              STR      r0,[r1,#0]  ; Accped_rSum
0001c0  480c              LDR      r0,|L4.500|
0001c2  7800              LDRB     r0,[r0,#0]            ;450  ; j
0001c4  1c40              ADDS     r0,r0,#1              ;450
0001c6  490b              LDR      r1,|L4.500|
0001c8  7008              STRB     r0,[r1,#0]            ;450
                  |L4.458|
0001ca  480a              LDR      r0,|L4.500|
0001cc  7800              LDRB     r0,[r0,#0]            ;450  ; j
0001ce  281e              CMP      r0,#0x1e              ;450
0001d0  dbec              BLT      |L4.428|
;;;453    	}
;;;454    	Accped_r3s = Accped_rSum/30;
0001d2  4814              LDR      r0,|L4.548|
0001d4  6800              LDR      r0,[r0,#0]  ; Accped_rSum
0001d6  211e              MOVS     r1,#0x1e
0001d8  fb90f0f1          SDIV     r0,r0,r1
0001dc  4912              LDR      r1,|L4.552|
0001de  6008              STR      r0,[r1,#0]  ; Accped_r3s
;;;455    //------------------------------------------------------------------------------------------		
;;;456    }
0001e0  bd10              POP      {r4,pc}
;;;457    extern const uint16_t  TrqlimM[2][15];
                          ENDP

0001e2  0000              DCW      0x0000
                  |L4.484|
                          DCD      i
                  |L4.488|
                          DCD      CoEng_rtrqInr100ms
                  |L4.492|
                          DCD      Curr_trq
                  |L4.496|
                          DCD      Coeng_rtrqInrSum
                  |L4.500|
                          DCD      j
                  |L4.504|
                          DCD      CoEng_rtrqInrAvg
                  |L4.508|
                          DCD      CoEng_rDrvLoad100ms
                  |L4.512|
                          DCD      CoEng_rDrvLoad
                  |L4.516|
                          DCD      Coeng_rDrvLoadSum
                  |L4.520|
                          DCD      CoEng_rDrv10Load
                  |L4.524|
                          DCD      Eng_nAvg100ms
                  |L4.528|
                          DCD      Eng_nAvg
                  |L4.532|
                          DCD      Eng_nAvgSum
                  |L4.536|
                          DCD      Eng_nAvg20
                  |L4.540|
                          DCD      Accped_r100ms
                  |L4.544|
                          DCD      Accped_rint
                  |L4.548|
                          DCD      Accped_rSum
                  |L4.552|
                          DCD      Accped_r3s

                          AREA ||i.ConstLimitation||, CODE, READONLY, ALIGN=2

                  ConstLimitation PROC
;;;481    //稳油功能
;;;482    void ConstLimitation(void)
000000  b510              PUSH     {r4,lr}
;;;483    {
;;;484       static u16 TimerAPPCnt0;
;;;485       static u8  APP_T0;
;;;486    
;;;487       if(TimerAPPCnt0 < 65530)
000002  4854              LDR      r0,|L5.340|
000004  8800              LDRH     r0,[r0,#0]  ; TimerAPPCnt0
000006  f64f71fa          MOV      r1,#0xfffa
00000a  4288              CMP      r0,r1
00000c  da04              BGE      |L5.24|
;;;488    	   TimerAPPCnt0 ++;
00000e  4851              LDR      r0,|L5.340|
000010  8800              LDRH     r0,[r0,#0]  ; TimerAPPCnt0
000012  1c40              ADDS     r0,r0,#1
000014  494f              LDR      r1,|L5.340|
000016  8008              STRH     r0,[r1,#0]
                  |L5.24|
;;;489       if(TimerAPPCnt0 >= 500) 
000018  484e              LDR      r0,|L5.340|
00001a  8800              LDRH     r0,[r0,#0]  ; TimerAPPCnt0
00001c  f5b07ffa          CMP      r0,#0x1f4
000020  db02              BLT      |L5.40|
;;;490    	   APP_T0 = 1; 
000022  2001              MOVS     r0,#1
000024  494c              LDR      r1,|L5.344|
000026  7008              STRB     r0,[r1,#0]
                  |L5.40|
;;;491    
;;;492       rdev = 20;mrdev = - 20;
000028  2014              MOVS     r0,#0x14
00002a  494c              LDR      r1,|L5.348|
00002c  7008              STRB     r0,[r1,#0]
00002e  20ec              MOVS     r0,#0xec
000030  494b              LDR      r1,|L5.352|
000032  7008              STRB     r0,[r1,#0]
;;;493       
;;;494       App_dev = Accped_rint - Accped_r3s;
000034  484b              LDR      r0,|L5.356|
000036  6800              LDR      r0,[r0,#0]  ; Accped_rint
000038  494b              LDR      r1,|L5.360|
00003a  6809              LDR      r1,[r1,#0]  ; Accped_r3s
00003c  1a40              SUBS     r0,r0,r1
00003e  494b              LDR      r1,|L5.364|
000040  6008              STR      r0,[r1,#0]  ; App_dev
;;;495       
;;;496    	if(App_rFreeze == 0) //油门开度值冻结   在冻结状态 - 不是零    不在冻结状态 = 0
000042  484b              LDR      r0,|L5.368|
000044  6800              LDR      r0,[r0,#0]  ; App_rFreeze
000046  2800              CMP      r0,#0
000048  d144              BNE      |L5.212|
;;;497    	{ 	
;;;498    		if((Load_stCurr == Midload || Load_stCurr == Lowload) && App_dev >= mrdev && //油门的波动范围  正负 20%
00004a  484a              LDR      r0,|L5.372|
00004c  7800              LDRB     r0,[r0,#0]  ; Load_stCurr
00004e  2802              CMP      r0,#2
000050  d003              BEQ      |L5.90|
000052  4848              LDR      r0,|L5.372|
000054  7800              LDRB     r0,[r0,#0]  ; Load_stCurr
000056  2801              CMP      r0,#1
000058  d136              BNE      |L5.200|
                  |L5.90|
00005a  4844              LDR      r0,|L5.364|
00005c  6800              LDR      r0,[r0,#0]  ; App_dev
00005e  4940              LDR      r1,|L5.352|
000060  f9911000          LDRSB    r1,[r1,#0]  ; mrdev
000064  4288              CMP      r0,r1
000066  db2f              BLT      |L5.200|
;;;499    			App_dev <= rdev && Eng_nAvg > 1000 && Accped_rint > 10 &&    //发动机转速 > 1000，油门开度 > 10%
000068  4840              LDR      r0,|L5.364|
00006a  6800              LDR      r0,[r0,#0]  ; App_dev
00006c  493b              LDR      r1,|L5.348|
00006e  f9911000          LDRSB    r1,[r1,#0]  ; rdev
000072  4288              CMP      r0,r1
000074  dc28              BGT      |L5.200|
000076  4940              LDR      r1,|L5.376|
000078  4840              LDR      r0,|L5.380|
00007a  6800              LDR      r0,[r0,#0]  ; Eng_nAvg
00007c  f7fffffe          BL       __aeabi_cfrcmple
000080  d222              BCS      |L5.200|
000082  4838              LDR      r0,|L5.356|
000084  6800              LDR      r0,[r0,#0]  ; Accped_rint
000086  280a              CMP      r0,#0xa
000088  dd1e              BLE      |L5.200|
;;;500    			Accped_rint < 85 && Accped_r3s > 10)                          //踏板波动小于 20  3 秒的平均开度
00008a  4836              LDR      r0,|L5.356|
00008c  6800              LDR      r0,[r0,#0]  ; Accped_rint
00008e  2855              CMP      r0,#0x55
000090  da1a              BGE      |L5.200|
000092  4835              LDR      r0,|L5.360|
000094  6800              LDR      r0,[r0,#0]  ; Accped_r3s
000096  280a              CMP      r0,#0xa
000098  dd16              BLE      |L5.200|
;;;501    		{
;;;502    			if((APP_T0 == 1)&&(CL_stOutflag == 0))  //计时保持 5 秒
00009a  482f              LDR      r0,|L5.344|
00009c  7800              LDRB     r0,[r0,#0]  ; APP_T0
00009e  2801              CMP      r0,#1
0000a0  d157              BNE      |L5.338|
0000a2  4837              LDR      r0,|L5.384|
0000a4  7800              LDRB     r0,[r0,#0]  ; CL_stOutflag
0000a6  2800              CMP      r0,#0
0000a8  d153              BNE      |L5.338|
;;;503    			{
;;;504    				trqmax = CoEng_rtrqInrAvg + 1; // todo:跟平均负荷有什么关系   trqmax - 稳油的扭矩限制
0000aa  4836              LDR      r0,|L5.388|
0000ac  8800              LDRH     r0,[r0,#0]  ; CoEng_rtrqInrAvg
0000ae  1c40              ADDS     r0,r0,#1
0000b0  4935              LDR      r1,|L5.392|
0000b2  8008              STRH     r0,[r1,#0]
;;;505    				TimerAPP0Reset();              // 定时器复位就是清  APP_T0
0000b4  2000              MOVS     r0,#0
0000b6  4927              LDR      r1,|L5.340|
0000b8  8008              STRH     r0,[r1,#0]
0000ba  4927              LDR      r1,|L5.344|
0000bc  7008              STRB     r0,[r1,#0]
;;;506    				App_rFreeze = Accped_rint;     // 记住当前的油门开度
0000be  4829              LDR      r0,|L5.356|
0000c0  6800              LDR      r0,[r0,#0]  ; Accped_rint
0000c2  492b              LDR      r1,|L5.368|
0000c4  6008              STR      r0,[r1,#0]  ; App_rFreeze
0000c6  e044              B        |L5.338|
                  |L5.200|
;;;507    			}
;;;508    		}
;;;509    		else 
;;;510    		{
;;;511    			TimerAPP0Reset();                  //退出稳油
0000c8  2000              MOVS     r0,#0
0000ca  4922              LDR      r1,|L5.340|
0000cc  8008              STRH     r0,[r1,#0]
0000ce  4922              LDR      r1,|L5.344|
0000d0  7008              STRB     r0,[r1,#0]
0000d2  e03e              B        |L5.338|
                  |L5.212|
;;;512    		}
;;;513    	}
;;;514    	else if(Load_stCurr == Highload            //当前在重载
0000d4  4827              LDR      r0,|L5.372|
0000d6  7800              LDRB     r0,[r0,#0]  ; Load_stCurr
0000d8  2803              CMP      r0,#3
0000da  d02a              BEQ      |L5.306|
;;;515    		||Accped_r <= 10||Accped_r >= 85       //松掉油门 或者 踩到底
0000dc  492b              LDR      r1,|L5.396|
0000de  482c              LDR      r0,|L5.400|
0000e0  6800              LDR      r0,[r0,#0]  ; Accped_r
0000e2  f7fffffe          BL       __aeabi_cfcmple
0000e6  d924              BLS      |L5.306|
0000e8  492a              LDR      r1,|L5.404|
0000ea  4829              LDR      r0,|L5.400|
0000ec  6800              LDR      r0,[r0,#0]  ; Accped_r
0000ee  f7fffffe          BL       __aeabi_cfrcmple
0000f2  d91e              BLS      |L5.306|
;;;516    		||App_dev <- 25 ||App_dev  >  15 || (Accped_rint - App_rFreeze) >20 
0000f4  481d              LDR      r0,|L5.364|
0000f6  6800              LDR      r0,[r0,#0]  ; App_dev
0000f8  f1100f19          CMN      r0,#0x19
0000fc  db19              BLT      |L5.306|
0000fe  481b              LDR      r0,|L5.364|
000100  6800              LDR      r0,[r0,#0]  ; App_dev
000102  280f              CMP      r0,#0xf
000104  dc15              BGT      |L5.306|
000106  4817              LDR      r0,|L5.356|
000108  6800              LDR      r0,[r0,#0]  ; Accped_rint
00010a  4919              LDR      r1,|L5.368|
00010c  6809              LDR      r1,[r1,#0]  ; App_rFreeze
00010e  1a40              SUBS     r0,r0,r1
000110  2814              CMP      r0,#0x14
000112  dc0e              BGT      |L5.306|
;;;517    		||(Accped_rint - App_rFreeze) <- 25||(Accped_r3s - App_rFreeze)>15)//踩踏板大于 5 
000114  4813              LDR      r0,|L5.356|
000116  6800              LDR      r0,[r0,#0]  ; Accped_rint
000118  4915              LDR      r1,|L5.368|
00011a  6809              LDR      r1,[r1,#0]  ; App_rFreeze
00011c  1a40              SUBS     r0,r0,r1
00011e  f1100f19          CMN      r0,#0x19
000122  db06              BLT      |L5.306|
000124  4810              LDR      r0,|L5.360|
000126  6800              LDR      r0,[r0,#0]  ; Accped_r3s
000128  4911              LDR      r1,|L5.368|
00012a  6809              LDR      r1,[r1,#0]  ; App_rFreeze
00012c  1a40              SUBS     r0,r0,r1
00012e  280f              CMP      r0,#0xf
000130  dd0a              BLE      |L5.328|
                  |L5.306|
;;;518    	{
;;;519    		CL_stOutflag = 1; //取消扭矩限制
000132  2001              MOVS     r0,#1
000134  4912              LDR      r1,|L5.384|
000136  7008              STRB     r0,[r1,#0]
;;;520    		App_rFreeze = 0; 
000138  2000              MOVS     r0,#0
00013a  490d              LDR      r1,|L5.368|
00013c  6008              STR      r0,[r1,#0]  ; App_rFreeze
;;;521    		TimerAPP0Reset(); //重新计时 
00013e  4905              LDR      r1,|L5.340|
000140  8008              STRH     r0,[r1,#0]
000142  4905              LDR      r1,|L5.344|
000144  7008              STRB     r0,[r1,#0]
000146  e004              B        |L5.338|
                  |L5.328|
;;;522    	}
;;;523    	else 
;;;524    	{
;;;525    		TimerAPP0Reset();	  
000148  2000              MOVS     r0,#0
00014a  4902              LDR      r1,|L5.340|
00014c  8008              STRH     r0,[r1,#0]
00014e  4902              LDR      r1,|L5.344|
000150  7008              STRB     r0,[r1,#0]
                  |L5.338|
;;;526    	}
;;;527    }
000152  bd10              POP      {r4,pc}
;;;528    
                          ENDP

                  |L5.340|
                          DCD      TimerAPPCnt0
                  |L5.344|
                          DCD      APP_T0
                  |L5.348|
                          DCD      rdev
                  |L5.352|
                          DCD      mrdev
                  |L5.356|
                          DCD      Accped_rint
                  |L5.360|
                          DCD      Accped_r3s
                  |L5.364|
                          DCD      App_dev
                  |L5.368|
                          DCD      App_rFreeze
                  |L5.372|
                          DCD      Load_stCurr
                  |L5.376|
                          DCD      0x447a0000
                  |L5.380|
                          DCD      Eng_nAvg
                  |L5.384|
                          DCD      CL_stOutflag
                  |L5.388|
                          DCD      CoEng_rtrqInrAvg
                  |L5.392|
                          DCD      trqmax
                  |L5.396|
                          DCD      0x41200000
                  |L5.400|
                          DCD      Accped_r
                  |L5.404|
                          DCD      0x42aa0000

                          AREA ||i.GearDetect||, CODE, READONLY, ALIGN=2

                  GearDetect PROC
;;;365    
;;;366    void GearDetect(void)  //10ms     输入信号的获取 
000000  e92d41f0          PUSH     {r4-r8,lr}
;;;367    {
;;;368    	Eng_nAvg       = Eng_nRaw / 8;                     //发动机转速 / 8
000004  4874              LDR      r0,|L6.472|
000006  78c1              LDRB     r1,[r0,#3]  ; RCVData0
000008  7900              LDRB     r0,[r0,#4]  ; RCVData0
00000a  eb012400          ADD      r4,r1,r0,LSL #8
00000e  17e1              ASRS     r1,r4,#31
000010  eb047151          ADD      r1,r4,r1,LSR #29
000014  10c8              ASRS     r0,r1,#3
000016  f7fffffe          BL       __aeabi_i2f
00001a  4970              LDR      r1,|L6.476|
00001c  6008              STR      r0,[r1,#0]  ; Eng_nAvg
;;;369    	Eng_nAvgFlt    = SignalFlter(Eng_nAvg,Eng_nAvgFltOld,0.5);//
00001e  f04f527c          MOV      r2,#0x3f000000
000022  486f              LDR      r0,|L6.480|
000024  6801              LDR      r1,[r0,#0]  ; Eng_nAvgFltOld
000026  486d              LDR      r0,|L6.476|
000028  6800              LDR      r0,[r0,#0]  ; Eng_nAvg
00002a  f7fffffe          BL       SignalFlter
00002e  496d              LDR      r1,|L6.484|
000030  6008              STR      r0,[r1,#0]  ; Eng_nAvgFlt
;;;370    	Eng_nAvgFltOld = Eng_nAvgFlt;
000032  4608              MOV      r0,r1
000034  6800              LDR      r0,[r0,#0]  ; Eng_nAvgFlt
000036  496a              LDR      r1,|L6.480|
000038  6008              STR      r0,[r1,#0]  ; Eng_nAvgFltOld
;;;371    	Eng_nAvgFltInt = (int)Eng_nAvgFlt;
00003a  486a              LDR      r0,|L6.484|
00003c  6800              LDR      r0,[r0,#0]  ; Eng_nAvgFlt
00003e  f7fffffe          BL       __aeabi_f2iz
000042  4969              LDR      r1,|L6.488|
000044  8008              STRH     r0,[r1,#0]
;;;372    	Curr_trq       = Curr_trqRaw;         //内部扭拒 当前扭矩
000046  4864              LDR      r0,|L6.472|
000048  7880              LDRB     r0,[r0,#2]  ; RCVData0
00004a  4968              LDR      r1,|L6.492|
00004c  7008              STRB     r0,[r1,#0]
;;;373    	if(BAM_EC1[0]==0x20 && BAM_EC1[1] == 0x27 && BAM_EC1[2] == 0x00)
00004e  4868              LDR      r0,|L6.496|
000050  7800              LDRB     r0,[r0,#0]  ; RCVData6
000052  2820              CMP      r0,#0x20
000054  d125              BNE      |L6.162|
000056  4866              LDR      r0,|L6.496|
000058  7840              LDRB     r0,[r0,#1]  ; RCVData6
00005a  2827              CMP      r0,#0x27
00005c  d121              BNE      |L6.162|
00005e  4864              LDR      r0,|L6.496|
000060  7880              LDRB     r0,[r0,#2]  ; RCVData6
000062  b9f0              CBNZ     r0,|L6.162|
;;;374    	{	  
;;;375    		if(EC1_PackNum == 3)//这个变量没找到赋值的地方啊
000064  4863              LDR      r0,|L6.500|
000066  7800              LDRB     r0,[r0,#0]  ; RCVData5
000068  2803              CMP      r0,#3
00006a  d109              BNE      |L6.128|
;;;376    		{
;;;377    			Moffrm_trqMax = Moffrm_trqMaxRaw;   //最大扭矩
00006c  4961              LDR      r1,|L6.500|
00006e  798a              LDRB     r2,[r1,#6]  ; RCVData5
000070  79c9              LDRB     r1,[r1,#7]  ; RCVData5
000072  eb022001          ADD      r0,r2,r1,LSL #8
000076  f7fffffe          BL       __aeabi_i2f
00007a  495f              LDR      r1,|L6.504|
00007c  6008              STR      r0,[r1,#0]  ; Moffrm_trqMax
00007e  e010              B        |L6.162|
                  |L6.128|
;;;378    		} 
;;;379    		else if(EC1_PackNum == 1)
000080  485c              LDR      r0,|L6.500|
000082  7800              LDRB     r0,[r0,#0]  ; RCVData5
000084  2801              CMP      r0,#1
000086  d10c              BNE      |L6.162|
;;;380    		{
;;;381    			RateSpeed = RateSpeedRaw/8;
000088  485a              LDR      r0,|L6.500|
00008a  7901              LDRB     r1,[r0,#4]  ; RCVData5
00008c  7940              LDRB     r0,[r0,#5]  ; RCVData5
00008e  eb012400          ADD      r4,r1,r0,LSL #8
000092  17e1              ASRS     r1,r4,#31
000094  eb047151          ADD      r1,r4,r1,LSR #29
000098  10c8              ASRS     r0,r1,#3
00009a  f7fffffe          BL       __aeabi_i2f
00009e  4957              LDR      r1,|L6.508|
0000a0  6008              STR      r0,[r1,#0]  ; RateSpeed
                  |L6.162|
;;;382    		}
;;;383    	}    
;;;384    	Coeng_trqInrCurr = Curr_trq*Moffrm_trqMax/100;   //赋值之后怎么没有后续的操作呢？没用
0000a2  4852              LDR      r0,|L6.492|
0000a4  7800              LDRB     r0,[r0,#0]  ; Curr_trq
0000a6  f7fffffe          BL       __aeabi_ui2f
0000aa  4606              MOV      r6,r0
0000ac  4852              LDR      r0,|L6.504|
0000ae  6801              LDR      r1,[r0,#0]  ; Moffrm_trqMax
0000b0  4630              MOV      r0,r6
0000b2  f7fffffe          BL       __aeabi_fmul
0000b6  4605              MOV      r5,r0
0000b8  4951              LDR      r1,|L6.512|
0000ba  f7fffffe          BL       __aeabi_fdiv
0000be  4604              MOV      r4,r0
0000c0  f7fffffe          BL       __aeabi_f2iz
0000c4  494f              LDR      r1,|L6.516|
0000c6  6008              STR      r0,[r1,#0]  ; Coeng_trqInrCurr
;;;385    	EngPrt_trqLim  = EngPrt_trqLimRaw / 10;          //外特性 / 10
0000c8  484f              LDR      r0,|L6.520|
0000ca  7801              LDRB     r1,[r0,#0]  ; RCVData3
0000cc  7840              LDRB     r0,[r0,#1]  ; RCVData3
0000ce  eb012000          ADD      r0,r1,r0,LSL #8
0000d2  210a              MOVS     r1,#0xa
0000d4  fb90f4f1          SDIV     r4,r0,r1
0000d8  4620              MOV      r0,r4
0000da  f7fffffe          BL       __aeabi_i2f
0000de  494b              LDR      r1,|L6.524|
0000e0  6008              STR      r0,[r1,#0]  ; EngPrt_trqLim
;;;386    	CoEng_trq      = CoEng_trqRaw/10;                //发动机的输出扭矩 / 10
0000e2  484b              LDR      r0,|L6.528|
0000e4  7901              LDRB     r1,[r0,#4]  ; RCVData2
0000e6  7940              LDRB     r0,[r0,#5]  ; RCVData2
0000e8  eb012000          ADD      r0,r1,r0,LSL #8
0000ec  210a              MOVS     r1,#0xa
0000ee  fb90f4f1          SDIV     r4,r0,r1
0000f2  4620              MOV      r0,r4
0000f4  f7fffffe          BL       __aeabi_i2f
0000f8  4946              LDR      r1,|L6.532|
0000fa  6008              STR      r0,[r1,#0]  ; CoEng_trq
;;;387    	CoEng_trqint   = (signed int)CoEng_trq;		     //取整
0000fc  4608              MOV      r0,r1
0000fe  6800              LDR      r0,[r0,#0]  ; CoEng_trq
000100  f7fffffe          BL       __aeabi_f2iz
000104  4944              LDR      r1,|L6.536|
000106  6008              STR      r0,[r1,#0]  ; CoEng_trqint
;;;388    	Accped_r       = Accped_rRaw*0.4;                //踏板 * 0.4
000108  4944              LDR      r1,|L6.540|
00010a  7848              LDRB     r0,[r1,#1]  ; RCVData1
00010c  f7fffffe          BL       __aeabi_ui2d
000110  4606              MOV      r6,r0
000112  4a43              LDR      r2,|L6.544|
000114  4b43              LDR      r3,|L6.548|
000116  f7fffffe          BL       __aeabi_dmul
00011a  4604              MOV      r4,r0
00011c  f7fffffe          BL       __aeabi_d2f
000120  4941              LDR      r1,|L6.552|
000122  6008              STR      r0,[r1,#0]  ; Accped_r
;;;389    	Accped_rint    = (int)Accped_r;	                 //对踏板运算结果取整
000124  4608              MOV      r0,r1
000126  6800              LDR      r0,[r0,#0]  ; Accped_r
000128  f7fffffe          BL       __aeabi_f2iz
00012c  493f              LDR      r1,|L6.556|
00012e  6008              STR      r0,[r1,#0]  ; Accped_rint
;;;390    	Accped_rFlt    = SignalFlter(Accped_r,Accped_rFltOld,Accpet_tiPT1);//（踏板运算，上次踏板，0.9）
000130  4a3f              LDR      r2,|L6.560|
000132  4840              LDR      r0,|L6.564|
000134  6801              LDR      r1,[r0,#0]  ; Accped_rFltOld
000136  483c              LDR      r0,|L6.552|
000138  6800              LDR      r0,[r0,#0]  ; Accped_r
00013a  f7fffffe          BL       SignalFlter
00013e  493e              LDR      r1,|L6.568|
000140  6008              STR      r0,[r1,#0]  ; Accped_rFlt
;;;391    	Accped_rFltOld = Accped_rFlt;                    //将旧值覆盖，（踏板）
000142  4608              MOV      r0,r1
000144  6800              LDR      r0,[r0,#0]  ; Accped_rFlt
000146  493b              LDR      r1,|L6.564|
000148  6008              STR      r0,[r1,#0]  ; Accped_rFltOld
;;;392    	Accped_rFltint = (int)Accped_rFlt;               //取整
00014a  483b              LDR      r0,|L6.568|
00014c  6800              LDR      r0,[r0,#0]  ; Accped_rFlt
00014e  f7fffffe          BL       __aeabi_f2iz
000152  493a              LDR      r1,|L6.572|
000154  6008              STR      r0,[r1,#0]  ; Accped_rFltint
;;;393    	CoEng_TrqFrc   = CoEng_TrqFrcRaw - 125;	         //摩擦扭矩  运算
000156  493a              LDR      r1,|L6.576|
000158  7809              LDRB     r1,[r1,#0]  ; RCVData4
00015a  f1a1007d          SUB      r0,r1,#0x7d
00015e  f7fffffe          BL       __aeabi_i2f
000162  4938              LDR      r1,|L6.580|
000164  6008              STR      r0,[r1,#0]  ; CoEng_TrqFrc
;;;394    	CoEng_rDrvLoad = DrvDem_trqRaw   - 125;          //驾驶员需求扭矩 运算
000166  481c              LDR      r0,|L6.472|
000168  7840              LDRB     r0,[r0,#1]  ; RCVData0
00016a  387d              SUBS     r0,r0,#0x7d
00016c  4936              LDR      r1,|L6.584|
00016e  7008              STRB     r0,[r1,#0]
;;;395    	CoEng_rDrvLoadFlt    = SignalFlter((float)CoEng_rDrvLoad,CoEng_rDrvLoadFltOld,CoEng_tiPT1rDrvLoad);//（需求扭矩，上次需求，0.7）
000170  4608              MOV      r0,r1
000172  7800              LDRB     r0,[r0,#0]  ; CoEng_rDrvLoad
000174  f7fffffe          BL       __aeabi_ui2f
000178  4604              MOV      r4,r0
00017a  4a34              LDR      r2,|L6.588|
00017c  4834              LDR      r0,|L6.592|
00017e  6801              LDR      r1,[r0,#0]  ; CoEng_rDrvLoadFltOld
000180  4620              MOV      r0,r4
000182  f7fffffe          BL       SignalFlter
000186  4933              LDR      r1,|L6.596|
000188  6008              STR      r0,[r1,#0]  ; CoEng_rDrvLoadFlt
;;;396    	CoEng_rDrvLoadFltOld = CoEng_rDrvLoadFlt;                               //旧的覆盖新的
00018a  4608              MOV      r0,r1
00018c  6800              LDR      r0,[r0,#0]  ; CoEng_rDrvLoadFlt
00018e  4930              LDR      r1,|L6.592|
000190  6008              STR      r0,[r1,#0]  ; CoEng_rDrvLoadFltOld
;;;397    	CoEng_trqDrv10Load   = CoEng_rDrv10Load*Moffrm_trqMax / 100;            //需求扭矩、最大扭矩、100
000192  4819              LDR      r0,|L6.504|
000194  6801              LDR      r1,[r0,#0]  ; Moffrm_trqMax
000196  4830              LDR      r0,|L6.600|
000198  6800              LDR      r0,[r0,#0]  ; CoEng_rDrv10Load
00019a  f7fffffe          BL       __aeabi_fmul
00019e  4605              MOV      r5,r0
0001a0  4917              LDR      r1,|L6.512|
0001a2  f7fffffe          BL       __aeabi_fdiv
0001a6  4604              MOV      r4,r0
0001a8  f7fffffe          BL       __aeabi_f2iz
0001ac  492b              LDR      r1,|L6.604|
0001ae  6008              STR      r0,[r1,#0]  ; CoEng_trqDrv10Load
;;;398    	EngPrt_trqNet        = EngPrt_trqLim-CoEng_TrqFrc * Moffrm_trqMax / 100;	//赋值之后无操作啊  外特性 - 摩擦扭矩计算*最大扭矩运算/100
0001b0  4811              LDR      r0,|L6.504|
0001b2  6801              LDR      r1,[r0,#0]  ; Moffrm_trqMax
0001b4  4823              LDR      r0,|L6.580|
0001b6  6800              LDR      r0,[r0,#0]  ; CoEng_TrqFrc
0001b8  f7fffffe          BL       __aeabi_fmul
0001bc  4605              MOV      r5,r0
0001be  4910              LDR      r1,|L6.512|
0001c0  f7fffffe          BL       __aeabi_fdiv
0001c4  4604              MOV      r4,r0
0001c6  4811              LDR      r0,|L6.524|
0001c8  6801              LDR      r1,[r0,#0]  ; EngPrt_trqLim
0001ca  4620              MOV      r0,r4
0001cc  f7fffffe          BL       __aeabi_frsub
0001d0  4923              LDR      r1,|L6.608|
0001d2  6008              STR      r0,[r1,#0]  ; EngPrt_trqNet
;;;399    }
0001d4  e8bd81f0          POP      {r4-r8,pc}
;;;400    
                          ENDP

                  |L6.472|
                          DCD      RCVData0
                  |L6.476|
                          DCD      Eng_nAvg
                  |L6.480|
                          DCD      Eng_nAvgFltOld
                  |L6.484|
                          DCD      Eng_nAvgFlt
                  |L6.488|
                          DCD      Eng_nAvgFltInt
                  |L6.492|
                          DCD      Curr_trq
                  |L6.496|
                          DCD      RCVData6
                  |L6.500|
                          DCD      RCVData5
                  |L6.504|
                          DCD      Moffrm_trqMax
                  |L6.508|
                          DCD      RateSpeed
                  |L6.512|
                          DCD      0x42c80000
                  |L6.516|
                          DCD      Coeng_trqInrCurr
                  |L6.520|
                          DCD      RCVData3
                  |L6.524|
                          DCD      EngPrt_trqLim
                  |L6.528|
                          DCD      RCVData2
                  |L6.532|
                          DCD      CoEng_trq
                  |L6.536|
                          DCD      CoEng_trqint
                  |L6.540|
                          DCD      RCVData1
                  |L6.544|
                          DCD      0x9999999a
                  |L6.548|
                          DCD      0x3fd99999
                  |L6.552|
                          DCD      Accped_r
                  |L6.556|
                          DCD      Accped_rint
                  |L6.560|
                          DCD      0x3f666666
                  |L6.564|
                          DCD      Accped_rFltOld
                  |L6.568|
                          DCD      Accped_rFlt
                  |L6.572|
                          DCD      Accped_rFltint
                  |L6.576|
                          DCD      RCVData4
                  |L6.580|
                          DCD      CoEng_TrqFrc
                  |L6.584|
                          DCD      CoEng_rDrvLoad
                  |L6.588|
                          DCD      0x3f333333
                  |L6.592|
                          DCD      CoEng_rDrvLoadFltOld
                  |L6.596|
                          DCD      CoEng_rDrvLoadFlt
                  |L6.600|
                          DCD      CoEng_rDrv10Load
                  |L6.604|
                          DCD      CoEng_trqDrv10Load
                  |L6.608|
                          DCD      EngPrt_trqNet

                          AREA ||i.SaveFuleTask||, CODE, READONLY, ALIGN=2

                  SaveFuleTask PROC
;;;199     //节油任务
;;;200     void SaveFuleTask(void *pdata)
000000  2003              MOVS     r0,#3
;;;201    {
;;;202    	Load_stCurr   = Highload;      // 默认当前油门最大
000002  49c3              LDR      r1,|L7.784|
000004  7008              STRB     r0,[r1,#0]
;;;203    	Load_stTarget = Highload;      // 默认计算的油门也是最大
000006  49c3              LDR      r1,|L7.788|
000008  7008              STRB     r0,[r1,#0]
;;;204    	while(1)
00000a  e180              B        |L7.782|
                  |L7.12|
;;;205    	{
;;;206    		OSTimeDlyHMSM(0,0,0,1);	
00000c  2301              MOVS     r3,#1
00000e  2200              MOVS     r2,#0
000010  4611              MOV      r1,r2
000012  4610              MOV      r0,r2
000014  f7fffffe          BL       OSTimeDlyHMSM
;;;207    		
;;;208    		SystemTime10ms ++;
000018  48bf              LDR      r0,|L7.792|
00001a  7800              LDRB     r0,[r0,#0]  ; SystemTime10ms
00001c  1c40              ADDS     r0,r0,#1
00001e  49be              LDR      r1,|L7.792|
000020  7008              STRB     r0,[r1,#0]
;;;209    		SystemTime50ms ++;
000022  48be              LDR      r0,|L7.796|
000024  7800              LDRB     r0,[r0,#0]  ; SystemTime50ms
000026  1c40              ADDS     r0,r0,#1
000028  49bc              LDR      r1,|L7.796|
00002a  7008              STRB     r0,[r1,#0]
;;;210    		SystemTime100ms ++;
00002c  48bc              LDR      r0,|L7.800|
00002e  7800              LDRB     r0,[r0,#0]  ; SystemTime100ms
000030  1c40              ADDS     r0,r0,#1
000032  49bb              LDR      r1,|L7.800|
000034  7008              STRB     r0,[r1,#0]
;;;211    		SystemTime500ms ++;
000036  48bb              LDR      r0,|L7.804|
000038  7800              LDRB     r0,[r0,#0]  ; SystemTime500ms
00003a  1c40              ADDS     r0,r0,#1
00003c  49b9              LDR      r1,|L7.804|
00003e  7008              STRB     r0,[r1,#0]
;;;212    		SystemTime1s ++;
000040  48b9              LDR      r0,|L7.808|
000042  7800              LDRB     r0,[r0,#0]  ; SystemTime1s
000044  1c40              ADDS     r0,r0,#1
000046  49b8              LDR      r1,|L7.808|
000048  7008              STRB     r0,[r1,#0]
;;;213    		
;;;214    //每毫秒都会进行数据检查
;;;215    		if(SystemTime10ms >= 10)
00004a  48b3              LDR      r0,|L7.792|
00004c  7800              LDRB     r0,[r0,#0]  ; SystemTime10ms
00004e  280a              CMP      r0,#0xa
000050  db7d              BLT      |L7.334|
;;;216    		{
;;;217    			SystemTime10ms = 0;
000052  2000              MOVS     r0,#0
000054  49b0              LDR      r1,|L7.792|
000056  7008              STRB     r0,[r1,#0]
;;;218    			if(fCanOK) 
000058  48b4              LDR      r0,|L7.812|
00005a  7800              LDRB     r0,[r0,#0]  ; fCanOK
00005c  2800              CMP      r0,#0
00005e  d076              BEQ      |L7.334|
;;;219    			{
;;;220    				GearDetect();  // 输入信号的获取
000060  f7fffffe          BL       GearDetect
;;;221    				TrqLim();      // 扭拒限制计算
000064  f7fffffe          BL       TrqLim
;;;222    /*############################################################################### 
;;;223    						载荷状态变化时, 扭拒限制的斜率变化
;;;224    ################################################################################*/           
;;;225    				if(Load_stCurr == Highload)//当前是强动力模式
000068  48a9              LDR      r0,|L7.784|
00006a  7800              LDRB     r0,[r0,#0]  ; Load_stCurr
00006c  2803              CMP      r0,#3
00006e  d155              BNE      |L7.284|
;;;226    				{
;;;227    					if(Load_stTarget == Midload)//手机设定是中档模式
000070  48a8              LDR      r0,|L7.788|
000072  7800              LDRB     r0,[r0,#0]  ; Load_stTarget
000074  2802              CMP      r0,#2
000076  d124              BNE      |L7.194|
;;;228    					{
;;;229    						if(TrqLoad>TrqlimMid) 
000078  48ad              LDR      r0,|L7.816|
00007a  6800              LDR      r0,[r0,#0]  ; TrqlimMid
00007c  f7fffffe          BL       __aeabi_i2f
000080  4604              MOV      r4,r0
000082  48ac              LDR      r0,|L7.820|
000084  6801              LDR      r1,[r0,#0]  ; TrqLoad
000086  4620              MOV      r0,r4
000088  f7fffffe          BL       __aeabi_cfcmple
00008c  d20e              BCS      |L7.172|
;;;230    							TrqLoad = TrqLoad - 0.08; //8/s
00008e  48a9              LDR      r0,|L7.820|
000090  6800              LDR      r0,[r0,#0]  ; TrqLoad
000092  f7fffffe          BL       __aeabi_f2d
000096  4606              MOV      r6,r0
000098  4aa7              LDR      r2,|L7.824|
00009a  4ba8              LDR      r3,|L7.828|
00009c  f7fffffe          BL       __aeabi_dsub
0000a0  4604              MOV      r4,r0
0000a2  f7fffffe          BL       __aeabi_d2f
0000a6  49a3              LDR      r1,|L7.820|
0000a8  6008              STR      r0,[r1,#0]  ; TrqLoad
0000aa  e0e2              B        |L7.626|
                  |L7.172|
;;;231    						else 
;;;232    						{
;;;233    							Load_stCurr = Load_stTarget;
0000ac  4899              LDR      r0,|L7.788|
0000ae  7800              LDRB     r0,[r0,#0]  ; Load_stTarget
0000b0  4997              LDR      r1,|L7.784|
0000b2  7008              STRB     r0,[r1,#0]
;;;234    							TrqLoad = TrqlimMid;
0000b4  489e              LDR      r0,|L7.816|
0000b6  6800              LDR      r0,[r0,#0]  ; TrqlimMid
0000b8  f7fffffe          BL       __aeabi_i2f
0000bc  499d              LDR      r1,|L7.820|
0000be  6008              STR      r0,[r1,#0]  ; TrqLoad
0000c0  e0d7              B        |L7.626|
                  |L7.194|
;;;235    						}
;;;236    					} 
;;;237    					else if(Load_stTarget == Lowload)    //应该是低档模式
0000c2  4894              LDR      r0,|L7.788|
0000c4  7800              LDRB     r0,[r0,#0]  ; Load_stTarget
0000c6  2801              CMP      r0,#1
0000c8  d124              BNE      |L7.276|
;;;238    					{
;;;239    						if(TrqLoad > TrqlimLow) TrqLoad = TrqLoad - 0.08; //8/s
0000ca  489d              LDR      r0,|L7.832|
0000cc  6800              LDR      r0,[r0,#0]  ; TrqlimLow
0000ce  f7fffffe          BL       __aeabi_i2f
0000d2  4604              MOV      r4,r0
0000d4  4897              LDR      r0,|L7.820|
0000d6  6801              LDR      r1,[r0,#0]  ; TrqLoad
0000d8  4620              MOV      r0,r4
0000da  f7fffffe          BL       __aeabi_cfcmple
0000de  d20e              BCS      |L7.254|
0000e0  4894              LDR      r0,|L7.820|
0000e2  6800              LDR      r0,[r0,#0]  ; TrqLoad
0000e4  f7fffffe          BL       __aeabi_f2d
0000e8  4606              MOV      r6,r0
0000ea  4a93              LDR      r2,|L7.824|
0000ec  4b93              LDR      r3,|L7.828|
0000ee  f7fffffe          BL       __aeabi_dsub
0000f2  4604              MOV      r4,r0
0000f4  f7fffffe          BL       __aeabi_d2f
0000f8  498e              LDR      r1,|L7.820|
0000fa  6008              STR      r0,[r1,#0]  ; TrqLoad
0000fc  e0b9              B        |L7.626|
                  |L7.254|
;;;240    						else 
;;;241    						{
;;;242    							Load_stCurr = Load_stTarget;
0000fe  4885              LDR      r0,|L7.788|
000100  7800              LDRB     r0,[r0,#0]  ; Load_stTarget
000102  4983              LDR      r1,|L7.784|
000104  7008              STRB     r0,[r1,#0]
;;;243    							TrqLoad = TrqlimLow;
000106  488e              LDR      r0,|L7.832|
000108  6800              LDR      r0,[r0,#0]  ; TrqlimLow
00010a  f7fffffe          BL       __aeabi_i2f
00010e  4989              LDR      r1,|L7.820|
000110  6008              STR      r0,[r1,#0]  ; TrqLoad
000112  e0ae              B        |L7.626|
                  |L7.276|
;;;244    						}
;;;245    					} 
;;;246    					else TrqLoad = 225;     
000114  488b              LDR      r0,|L7.836|
000116  4987              LDR      r1,|L7.820|
000118  6008              STR      r0,[r1,#0]  ; TrqLoad
00011a  e0aa              B        |L7.626|
                  |L7.284|
;;;247    				} 
;;;248    				else if(Load_stCurr == Midload)
00011c  487c              LDR      r0,|L7.784|
00011e  7800              LDRB     r0,[r0,#0]  ; Load_stCurr
000120  2802              CMP      r0,#2
000122  d152              BNE      |L7.458|
;;;249    				{
;;;250    					if(Load_stTarget == Highload)
000124  487b              LDR      r0,|L7.788|
000126  7800              LDRB     r0,[r0,#0]  ; Load_stTarget
000128  2803              CMP      r0,#3
00012a  d11e              BNE      |L7.362|
;;;251    					{
;;;252    						if(TrqLoad < 225) 
00012c  4985              LDR      r1,|L7.836|
00012e  4881              LDR      r0,|L7.820|
000130  6800              LDR      r0,[r0,#0]  ; TrqLoad
000132  f7fffffe          BL       __aeabi_cfcmple
000136  d210              BCS      |L7.346|
;;;253    							TrqLoad = TrqLoad + 0.08; //8/s
000138  487e              LDR      r0,|L7.820|
00013a  6800              LDR      r0,[r0,#0]  ; TrqLoad
00013c  f7fffffe          BL       __aeabi_f2d
000140  4606              MOV      r6,r0
000142  4a7d              LDR      r2,|L7.824|
000144  4b7d              LDR      r3,|L7.828|
000146  f7fffffe          BL       __aeabi_dadd
00014a  4604              MOV      r4,r0
00014c  e000              B        |L7.336|
                  |L7.334|
00014e  e0af              B        |L7.688|
                  |L7.336|
000150  f7fffffe          BL       __aeabi_d2f
000154  4977              LDR      r1,|L7.820|
000156  6008              STR      r0,[r1,#0]  ; TrqLoad
000158  e08b              B        |L7.626|
                  |L7.346|
;;;254    						else 
;;;255    						{
;;;256    							Load_stCurr = Load_stTarget;
00015a  486e              LDR      r0,|L7.788|
00015c  7800              LDRB     r0,[r0,#0]  ; Load_stTarget
00015e  496c              LDR      r1,|L7.784|
000160  7008              STRB     r0,[r1,#0]
;;;257    							TrqLoad = 225;
000162  4878              LDR      r0,|L7.836|
000164  4973              LDR      r1,|L7.820|
000166  6008              STR      r0,[r1,#0]  ; TrqLoad
000168  e083              B        |L7.626|
                  |L7.362|
;;;258    						}
;;;259    					} 
;;;260    					else if(Load_stTarget == Lowload)
00016a  486a              LDR      r0,|L7.788|
00016c  7800              LDRB     r0,[r0,#0]  ; Load_stTarget
00016e  2801              CMP      r0,#1
000170  d124              BNE      |L7.444|
;;;261    					{
;;;262    						if(TrqLoad > TrqlimLow) 
000172  4873              LDR      r0,|L7.832|
000174  6800              LDR      r0,[r0,#0]  ; TrqlimLow
000176  f7fffffe          BL       __aeabi_i2f
00017a  4604              MOV      r4,r0
00017c  486d              LDR      r0,|L7.820|
00017e  6801              LDR      r1,[r0,#0]  ; TrqLoad
000180  4620              MOV      r0,r4
000182  f7fffffe          BL       __aeabi_cfcmple
000186  d20e              BCS      |L7.422|
;;;263    							TrqLoad = TrqLoad-0.08; //8/s
000188  486a              LDR      r0,|L7.820|
00018a  6800              LDR      r0,[r0,#0]  ; TrqLoad
00018c  f7fffffe          BL       __aeabi_f2d
000190  4606              MOV      r6,r0
000192  4a69              LDR      r2,|L7.824|
000194  4b69              LDR      r3,|L7.828|
000196  f7fffffe          BL       __aeabi_dsub
00019a  4604              MOV      r4,r0
00019c  f7fffffe          BL       __aeabi_d2f
0001a0  4964              LDR      r1,|L7.820|
0001a2  6008              STR      r0,[r1,#0]  ; TrqLoad
0001a4  e065              B        |L7.626|
                  |L7.422|
;;;264    						else 
;;;265    						{
;;;266    							Load_stCurr = Load_stTarget;
0001a6  485b              LDR      r0,|L7.788|
0001a8  7800              LDRB     r0,[r0,#0]  ; Load_stTarget
0001aa  4959              LDR      r1,|L7.784|
0001ac  7008              STRB     r0,[r1,#0]
;;;267    							TrqLoad = TrqlimLow;
0001ae  4864              LDR      r0,|L7.832|
0001b0  6800              LDR      r0,[r0,#0]  ; TrqlimLow
0001b2  f7fffffe          BL       __aeabi_i2f
0001b6  495f              LDR      r1,|L7.820|
0001b8  6008              STR      r0,[r1,#0]  ; TrqLoad
0001ba  e05a              B        |L7.626|
                  |L7.444|
;;;268    						}
;;;269    					} 
;;;270    					else TrqLoad = TrqlimMid; 
0001bc  485c              LDR      r0,|L7.816|
0001be  6800              LDR      r0,[r0,#0]  ; TrqlimMid
0001c0  f7fffffe          BL       __aeabi_i2f
0001c4  495b              LDR      r1,|L7.820|
0001c6  6008              STR      r0,[r1,#0]  ; TrqLoad
0001c8  e053              B        |L7.626|
                  |L7.458|
;;;271    				}
;;;272    				else if(Load_stCurr == Lowload)
0001ca  4851              LDR      r0,|L7.784|
0001cc  7800              LDRB     r0,[r0,#0]  ; Load_stCurr
0001ce  2801              CMP      r0,#1
0001d0  d14f              BNE      |L7.626|
;;;273    				{
;;;274    					if(Load_stTarget == Highload)
0001d2  4850              LDR      r0,|L7.788|
0001d4  7800              LDRB     r0,[r0,#0]  ; Load_stTarget
0001d6  2803              CMP      r0,#3
0001d8  d11c              BNE      |L7.532|
;;;275    					{
;;;276    						if(TrqLoad < 225) TrqLoad=TrqLoad+0.08; //8/s
0001da  495a              LDR      r1,|L7.836|
0001dc  4855              LDR      r0,|L7.820|
0001de  6800              LDR      r0,[r0,#0]  ; TrqLoad
0001e0  f7fffffe          BL       __aeabi_cfcmple
0001e4  d20e              BCS      |L7.516|
0001e6  4853              LDR      r0,|L7.820|
0001e8  6800              LDR      r0,[r0,#0]  ; TrqLoad
0001ea  f7fffffe          BL       __aeabi_f2d
0001ee  4606              MOV      r6,r0
0001f0  4a51              LDR      r2,|L7.824|
0001f2  4b52              LDR      r3,|L7.828|
0001f4  f7fffffe          BL       __aeabi_dadd
0001f8  4604              MOV      r4,r0
0001fa  f7fffffe          BL       __aeabi_d2f
0001fe  494d              LDR      r1,|L7.820|
000200  6008              STR      r0,[r1,#0]  ; TrqLoad
000202  e036              B        |L7.626|
                  |L7.516|
;;;277    						else
;;;278    						{
;;;279    							Load_stCurr=Load_stTarget;
000204  4843              LDR      r0,|L7.788|
000206  7800              LDRB     r0,[r0,#0]  ; Load_stTarget
000208  4941              LDR      r1,|L7.784|
00020a  7008              STRB     r0,[r1,#0]
;;;280    							TrqLoad=225;
00020c  484d              LDR      r0,|L7.836|
00020e  4949              LDR      r1,|L7.820|
000210  6008              STR      r0,[r1,#0]  ; TrqLoad
000212  e02e              B        |L7.626|
                  |L7.532|
;;;281    						}
;;;282    					} 
;;;283    					else if(Load_stTarget == Midload)
000214  483f              LDR      r0,|L7.788|
000216  7800              LDRB     r0,[r0,#0]  ; Load_stTarget
000218  2802              CMP      r0,#2
00021a  d124              BNE      |L7.614|
;;;284    					{
;;;285    						if(TrqLoad<TrqlimMid) TrqLoad = TrqLoad + 0.08; //  8/s
00021c  4844              LDR      r0,|L7.816|
00021e  6800              LDR      r0,[r0,#0]  ; TrqlimMid
000220  f7fffffe          BL       __aeabi_i2f
000224  4604              MOV      r4,r0
000226  4843              LDR      r0,|L7.820|
000228  6801              LDR      r1,[r0,#0]  ; TrqLoad
00022a  4620              MOV      r0,r4
00022c  f7fffffe          BL       __aeabi_cfrcmple
000230  d20e              BCS      |L7.592|
000232  4840              LDR      r0,|L7.820|
000234  6800              LDR      r0,[r0,#0]  ; TrqLoad
000236  f7fffffe          BL       __aeabi_f2d
00023a  4606              MOV      r6,r0
00023c  4a3e              LDR      r2,|L7.824|
00023e  4b3f              LDR      r3,|L7.828|
000240  f7fffffe          BL       __aeabi_dadd
000244  4604              MOV      r4,r0
000246  f7fffffe          BL       __aeabi_d2f
00024a  493a              LDR      r1,|L7.820|
00024c  6008              STR      r0,[r1,#0]  ; TrqLoad
00024e  e010              B        |L7.626|
                  |L7.592|
;;;286    						else 
;;;287    						{
;;;288    							Load_stCurr = Load_stTarget;
000250  4830              LDR      r0,|L7.788|
000252  7800              LDRB     r0,[r0,#0]  ; Load_stTarget
000254  492e              LDR      r1,|L7.784|
000256  7008              STRB     r0,[r1,#0]
;;;289    							TrqLoad = TrqlimMid;
000258  4835              LDR      r0,|L7.816|
00025a  6800              LDR      r0,[r0,#0]  ; TrqlimMid
00025c  f7fffffe          BL       __aeabi_i2f
000260  4934              LDR      r1,|L7.820|
000262  6008              STR      r0,[r1,#0]  ; TrqLoad
000264  e005              B        |L7.626|
                  |L7.614|
;;;290    						}
;;;291    					} 
;;;292    					else TrqLoad = TrqlimLow; 
000266  4836              LDR      r0,|L7.832|
000268  6800              LDR      r0,[r0,#0]  ; TrqlimLow
00026a  f7fffffe          BL       __aeabi_i2f
00026e  4931              LDR      r1,|L7.820|
000270  6008              STR      r0,[r1,#0]  ; TrqLoad
                  |L7.626|
;;;293    				}            
;;;294    				
;;;295    				if(varOperation.oilMode == 2)//节油功能
000272  4835              LDR      r0,|L7.840|
000274  f8900093          LDRB     r0,[r0,#0x93]  ; varOperation
000278  2802              CMP      r0,#2
00027a  d109              BNE      |L7.656|
;;;296    				{
;;;297    					ConstLimitation();    //稳油功能
00027c  f7fffffe          BL       ConstLimitation
;;;298    					UpdateTxDataAMT();    //todo:确定这个函数的功能  225  180  按照180来设定
000280  f7fffffe          BL       UpdateTxDataAMT
;;;299    					OBD_CAN_SendData(0x0C000021,CAN_ID_EXT,trq); //todo 发送节油，等待运行
000284  4a31              LDR      r2,|L7.844|
000286  2104              MOVS     r1,#4
000288  4831              LDR      r0,|L7.848|
00028a  f7fffffe          BL       OBD_CAN_SendData
00028e  e00f              B        |L7.688|
                  |L7.656|
;;;300    				}
;;;301    				else if(trq[3]<225)//当前模式非节油
000290  482e              LDR      r0,|L7.844|
000292  78c0              LDRB     r0,[r0,#3]  ; trq
000294  28e1              CMP      r0,#0xe1
000296  da0b              BGE      |L7.688|
;;;302    				{
;;;303    					trq[3]++;
000298  482c              LDR      r0,|L7.844|
00029a  78c0              LDRB     r0,[r0,#3]  ; trq
00029c  1c40              ADDS     r0,r0,#1
00029e  492b              LDR      r1,|L7.844|
0002a0  70c8              STRB     r0,[r1,#3]
;;;304    					trq[0] = 35;
0002a2  2023              MOVS     r0,#0x23
0002a4  7008              STRB     r0,[r1,#0]
;;;305    					OBD_CAN_SendData(0x0C000021,CAN_ID_EXT,trq);
0002a6  460a              MOV      r2,r1
0002a8  2104              MOVS     r1,#4
0002aa  4829              LDR      r0,|L7.848|
0002ac  f7fffffe          BL       OBD_CAN_SendData
                  |L7.688|
;;;306    				}
;;;307    					
;;;308    			}
;;;309    		}
;;;310    		if(SystemTime50ms)            //稳油退出 斜率   50ms + 1
0002b0  481a              LDR      r0,|L7.796|
0002b2  7800              LDRB     r0,[r0,#0]  ; SystemTime50ms
0002b4  b1b0              CBZ      r0,|L7.740|
;;;311    		{
;;;312    			SystemTime50ms = 0;
0002b6  2000              MOVS     r0,#0
0002b8  4918              LDR      r1,|L7.796|
0002ba  7008              STRB     r0,[r1,#0]
;;;313    			if(fCanOK) 
0002bc  481b              LDR      r0,|L7.812|
0002be  7800              LDRB     r0,[r0,#0]  ; fCanOK
0002c0  b180              CBZ      r0,|L7.740|
;;;314    			{
;;;315    				if(CL_stOutflag == 1) 
0002c2  4824              LDR      r0,|L7.852|
0002c4  7800              LDRB     r0,[r0,#0]  ; CL_stOutflag
0002c6  2801              CMP      r0,#1
0002c8  d10c              BNE      |L7.740|
;;;316    				{
;;;317    					if(trqmax < 225)    //最大值为啥要自增
0002ca  4823              LDR      r0,|L7.856|
0002cc  8800              LDRH     r0,[r0,#0]  ; trqmax
0002ce  28e1              CMP      r0,#0xe1
0002d0  da05              BGE      |L7.734|
;;;318    					{
;;;319    						trqmax++;
0002d2  4821              LDR      r0,|L7.856|
0002d4  8800              LDRH     r0,[r0,#0]  ; trqmax
0002d6  1c40              ADDS     r0,r0,#1
0002d8  491f              LDR      r1,|L7.856|
0002da  8008              STRH     r0,[r1,#0]
0002dc  e002              B        |L7.740|
                  |L7.734|
;;;320    					} 
;;;321    					else
;;;322    					{
;;;323    						CL_stOutflag = 0;
0002de  2000              MOVS     r0,#0
0002e0  491c              LDR      r1,|L7.852|
0002e2  7008              STRB     r0,[r1,#0]
                  |L7.740|
;;;324    					}
;;;325    				}
;;;326    			}
;;;327    		}
;;;328    		if(SystemTime100ms >= 100)//计算20秒的平均扭矩，3秒的平均油门
0002e4  480e              LDR      r0,|L7.800|
0002e6  7800              LDRB     r0,[r0,#0]  ; SystemTime100ms
0002e8  2864              CMP      r0,#0x64
0002ea  db10              BLT      |L7.782|
;;;329    		{
;;;330    			SystemTime100ms = 0;
0002ec  2000              MOVS     r0,#0
0002ee  490c              LDR      r1,|L7.800|
0002f0  7008              STRB     r0,[r1,#0]
;;;331    			numCAN=0;
0002f2  491a              LDR      r1,|L7.860|
0002f4  6008              STR      r0,[r1,#0]  ; numCAN
;;;332    			if(fCanOK)
0002f6  480d              LDR      r0,|L7.812|
0002f8  7800              LDRB     r0,[r0,#0]  ; fCanOK
0002fa  b128              CBZ      r0,|L7.776|
;;;333    			{
;;;334    				CoEng_rloadCal();    //平均负荷率计算, 平均转速计算, 平均油门计算
0002fc  f7fffffe          BL       CoEng_rloadCal
;;;335    //##############################################################
;;;336    				CANerr_flg = 1;  
000300  2001              MOVS     r0,#1
000302  4917              LDR      r1,|L7.864|
000304  7008              STRB     r0,[r1,#0]
000306  e002              B        |L7.782|
                  |L7.776|
;;;337    			}
;;;338    			else 
;;;339    				CANerr_flg = 0; 
000308  2000              MOVS     r0,#0
00030a  4915              LDR      r1,|L7.864|
00030c  7008              STRB     r0,[r1,#0]
                  |L7.782|
00030e  e67d              B        |L7.12|
;;;340    		} 
;;;341    	}
;;;342    }
;;;343     
                          ENDP

                  |L7.784|
                          DCD      Load_stCurr
                  |L7.788|
                          DCD      Load_stTarget
                  |L7.792|
                          DCD      SystemTime10ms
                  |L7.796|
                          DCD      SystemTime50ms
                  |L7.800|
                          DCD      SystemTime100ms
                  |L7.804|
                          DCD      SystemTime500ms
                  |L7.808|
                          DCD      SystemTime1s
                  |L7.812|
                          DCD      fCanOK
                  |L7.816|
                          DCD      TrqlimMid
                  |L7.820|
                          DCD      TrqLoad
                  |L7.824|
                          DCD      0x47ae147b
                  |L7.828|
                          DCD      0x3fb47ae1
                  |L7.832|
                          DCD      TrqlimLow
                  |L7.836|
                          DCD      0x43610000
                  |L7.840|
                          DCD      varOperation
                  |L7.844|
                          DCD      trq
                  |L7.848|
                          DCD      0x0c000021
                  |L7.852|
                          DCD      CL_stOutflag
                  |L7.856|
                          DCD      trqmax
                  |L7.860|
                          DCD      numCAN
                  |L7.864|
                          DCD      CANerr_flg

                          AREA ||i.SaveJieYouData||, CODE, READONLY, ALIGN=1

                  SaveJieYouData PROC
;;;344     
;;;345    void SaveJieYouData(CanRxMsg* CAN1_RxMsg)
000000  bf00              NOP      
;;;346    {
;;;347    	switch(CAN1_RxMsg->ExtId)
;;;348    	{
;;;349    		default:break;
000002  bf00              NOP      
000004  bf00              NOP      
;;;350    	} 
;;;351    }
000006  4770              BX       lr
;;;352    
                          ENDP


                          AREA ||i.SignalFlter||, CODE, READONLY, ALIGN=2

                  SignalFlter PROC
;;;358    }
;;;359    float SignalFlter(float x1, float yold, float ti) 
000000  e92d4ff7          PUSH     {r0-r2,r4-r11,lr}
;;;360    {
000004  b088              SUB      sp,sp,#0x20
000006  468a              MOV      r10,r1
000008  4693              MOV      r11,r2
;;;361        float y;
;;;362        y=(x1-yold)*(0.01/ti)+yold;
00000a  4650              MOV      r0,r10
00000c  f7fffffe          BL       __aeabi_f2d
000010  e9cd0104          STRD     r0,r1,[sp,#0x10]
000014  4658              MOV      r0,r11
000016  f7fffffe          BL       __aeabi_f2d
00001a  4680              MOV      r8,r0
00001c  4642              MOV      r2,r8
00001e  460b              MOV      r3,r1
000020  480f              LDR      r0,|L9.96|
000022  4910              LDR      r1,|L9.100|
000024  f7fffffe          BL       __aeabi_ddiv
000028  e9cd0100          STRD     r0,r1,[sp,#0]
00002c  4651              MOV      r1,r10
00002e  9808              LDR      r0,[sp,#0x20]
000030  f7fffffe          BL       __aeabi_fsub
000034  4680              MOV      r8,r0
000036  f7fffffe          BL       __aeabi_f2d
00003a  4606              MOV      r6,r0
00003c  e9dd2300          LDRD     r2,r3,[sp,#0]
000040  f7fffffe          BL       __aeabi_dmul
000044  e9cd0102          STRD     r0,r1,[sp,#8]
000048  e9dd2304          LDRD     r2,r3,[sp,#0x10]
00004c  f7fffffe          BL       __aeabi_dadd
000050  4604              MOV      r4,r0
000052  f7fffffe          BL       __aeabi_d2f
000056  9006              STR      r0,[sp,#0x18]
;;;363        return(y);
000058  9806              LDR      r0,[sp,#0x18]
;;;364    }
00005a  b00b              ADD      sp,sp,#0x2c
00005c  e8bd8ff0          POP      {r4-r11,pc}
;;;365    
                          ENDP

                  |L9.96|
                          DCD      0x47ae147b
                  |L9.100|
                          DCD      0x3f847ae1

                          AREA ||i.TrqLim||, CODE, READONLY, ALIGN=2

                  TrqLim PROC
;;;459    
;;;460    void TrqLim(void)          //扭矩限制计算
000000  b538              PUSH     {r3-r5,lr}
;;;461    {   
;;;462    	static u8  i,inow; 
;;;463    
;;;464    	for(i=0;i<14;i++)
000002  2000              MOVS     r0,#0
000004  4940              LDR      r1,|L10.264|
000006  7008              STRB     r0,[r1,#0]
000008  e01b              B        |L10.66|
                  |L10.10|
;;;465    	{
;;;466    		if(Eng_nAvgFltInt>=TrqlimM[0][i] && Eng_nAvgFltInt<TrqlimM[0][i+1]) //根据发动机转速来判断
00000a  4840              LDR      r0,|L10.268|
00000c  493e              LDR      r1,|L10.264|
00000e  7809              LDRB     r1,[r1,#0]  ; i
000010  f8300011          LDRH     r0,[r0,r1,LSL #1]
000014  493e              LDR      r1,|L10.272|
000016  8809              LDRH     r1,[r1,#0]  ; Eng_nAvgFltInt
000018  4288              CMP      r0,r1
00001a  dc0d              BGT      |L10.56|
00001c  493b              LDR      r1,|L10.268|
00001e  483a              LDR      r0,|L10.264|
000020  7800              LDRB     r0,[r0,#0]  ; i
000022  1c40              ADDS     r0,r0,#1
000024  f8310010          LDRH     r0,[r1,r0,LSL #1]
000028  4939              LDR      r1,|L10.272|
00002a  8809              LDRH     r1,[r1,#0]  ; Eng_nAvgFltInt
00002c  4288              CMP      r0,r1
00002e  dd03              BLE      |L10.56|
;;;467    			inow = i;
000030  4835              LDR      r0,|L10.264|
000032  7800              LDRB     r0,[r0,#0]  ; i
000034  4937              LDR      r1,|L10.276|
000036  7008              STRB     r0,[r1,#0]
                  |L10.56|
000038  4833              LDR      r0,|L10.264|
00003a  7800              LDRB     r0,[r0,#0]            ;464  ; i
00003c  1c40              ADDS     r0,r0,#1              ;464
00003e  4932              LDR      r1,|L10.264|
000040  7008              STRB     r0,[r1,#0]            ;464
                  |L10.66|
000042  4831              LDR      r0,|L10.264|
000044  7800              LDRB     r0,[r0,#0]            ;464  ; i
000046  280e              CMP      r0,#0xe               ;464
000048  dbdf              BLT      |L10.10|
;;;468    	}
;;;469    	TrqlimMid = calu(TrqlimM[0][inow],TrqlimM[0][inow+1],TrqlimM[1][inow],TrqlimM[1][inow+1],Eng_nAvgFltInt);
00004a  4831              LDR      r0,|L10.272|
00004c  8800              LDRH     r0,[r0,#0]  ; Eng_nAvgFltInt
00004e  4c2f              LDR      r4,|L10.268|
000050  341e              ADDS     r4,r4,#0x1e
000052  4d30              LDR      r5,|L10.276|
000054  9000              STR      r0,[sp,#0]
000056  782d              LDRB     r5,[r5,#0]  ; inow
000058  1c6d              ADDS     r5,r5,#1
00005a  f8343015          LDRH     r3,[r4,r5,LSL #1]
00005e  4d2d              LDR      r5,|L10.276|
000060  782d              LDRB     r5,[r5,#0]  ; inow
000062  f8342015          LDRH     r2,[r4,r5,LSL #1]
000066  4d29              LDR      r5,|L10.268|
000068  4c2a              LDR      r4,|L10.276|
00006a  7824              LDRB     r4,[r4,#0]  ; inow
00006c  1c64              ADDS     r4,r4,#1
00006e  f8351014          LDRH     r1,[r5,r4,LSL #1]
000072  462c              MOV      r4,r5
000074  4d27              LDR      r5,|L10.276|
000076  782d              LDRB     r5,[r5,#0]  ; inow
000078  f8340015          LDRH     r0,[r4,r5,LSL #1]
00007c  f7fffffe          BL       calu
000080  4925              LDR      r1,|L10.280|
000082  6008              STR      r0,[r1,#0]  ; TrqlimMid
;;;470           //限制值  中载
;;;471    	for(i=0;i<14;i++)
000084  2000              MOVS     r0,#0
000086  4920              LDR      r1,|L10.264|
000088  7008              STRB     r0,[r1,#0]
00008a  e01b              B        |L10.196|
                  |L10.140|
;;;472    	{
;;;473    		if(Eng_nAvgFltInt >= TrqlimL[0][i] && Eng_nAvgFltInt < TrqlimL[0][i+1])
00008c  4823              LDR      r0,|L10.284|
00008e  491e              LDR      r1,|L10.264|
000090  7809              LDRB     r1,[r1,#0]  ; i
000092  f8300011          LDRH     r0,[r0,r1,LSL #1]
000096  491e              LDR      r1,|L10.272|
000098  8809              LDRH     r1,[r1,#0]  ; Eng_nAvgFltInt
00009a  4288              CMP      r0,r1
00009c  dc0d              BGT      |L10.186|
00009e  491f              LDR      r1,|L10.284|
0000a0  4819              LDR      r0,|L10.264|
0000a2  7800              LDRB     r0,[r0,#0]  ; i
0000a4  1c40              ADDS     r0,r0,#1
0000a6  f8310010          LDRH     r0,[r1,r0,LSL #1]
0000aa  4919              LDR      r1,|L10.272|
0000ac  8809              LDRH     r1,[r1,#0]  ; Eng_nAvgFltInt
0000ae  4288              CMP      r0,r1
0000b0  dd03              BLE      |L10.186|
;;;474    			inow = i;
0000b2  4815              LDR      r0,|L10.264|
0000b4  7800              LDRB     r0,[r0,#0]  ; i
0000b6  4917              LDR      r1,|L10.276|
0000b8  7008              STRB     r0,[r1,#0]
                  |L10.186|
0000ba  4813              LDR      r0,|L10.264|
0000bc  7800              LDRB     r0,[r0,#0]            ;471  ; i
0000be  1c40              ADDS     r0,r0,#1              ;471
0000c0  4911              LDR      r1,|L10.264|
0000c2  7008              STRB     r0,[r1,#0]            ;471
                  |L10.196|
0000c4  4810              LDR      r0,|L10.264|
0000c6  7800              LDRB     r0,[r0,#0]            ;471  ; i
0000c8  280e              CMP      r0,#0xe               ;471
0000ca  dbdf              BLT      |L10.140|
;;;475    	}//轻载 如果是225   ECU会减掉125，意思是ECU只在  125 - 225 之间浮动运行
;;;476    	TrqlimLow = calu(TrqlimL[0][inow],TrqlimL[0][inow+1],TrqlimL[1][inow],TrqlimL[1][inow+1],Eng_nAvgFltInt);  	
0000cc  4810              LDR      r0,|L10.272|
0000ce  8800              LDRH     r0,[r0,#0]  ; Eng_nAvgFltInt
0000d0  4c12              LDR      r4,|L10.284|
0000d2  341e              ADDS     r4,r4,#0x1e
0000d4  4d0f              LDR      r5,|L10.276|
0000d6  9000              STR      r0,[sp,#0]
0000d8  782d              LDRB     r5,[r5,#0]  ; inow
0000da  1c6d              ADDS     r5,r5,#1
0000dc  f8343015          LDRH     r3,[r4,r5,LSL #1]
0000e0  4d0c              LDR      r5,|L10.276|
0000e2  782d              LDRB     r5,[r5,#0]  ; inow
0000e4  f8342015          LDRH     r2,[r4,r5,LSL #1]
0000e8  4d0c              LDR      r5,|L10.284|
0000ea  4c0a              LDR      r4,|L10.276|
0000ec  7824              LDRB     r4,[r4,#0]  ; inow
0000ee  1c64              ADDS     r4,r4,#1
0000f0  f8351014          LDRH     r1,[r5,r4,LSL #1]
0000f4  462c              MOV      r4,r5
0000f6  4d07              LDR      r5,|L10.276|
0000f8  782d              LDRB     r5,[r5,#0]  ; inow
0000fa  f8340015          LDRH     r0,[r4,r5,LSL #1]
0000fe  f7fffffe          BL       calu
000102  4907              LDR      r1,|L10.288|
000104  6008              STR      r0,[r1,#0]  ; TrqlimLow
;;;477    }
000106  bd38              POP      {r3-r5,pc}
;;;478    
                          ENDP

                  |L10.264|
                          DCD      |symbol_number.48|
                  |L10.268|
                          DCD      TrqlimM
                  |L10.272|
                          DCD      Eng_nAvgFltInt
                  |L10.276|
                          DCD      inow
                  |L10.280|
                          DCD      TrqlimMid
                  |L10.284|
                          DCD      TrqlimL
                  |L10.288|
                          DCD      TrqlimLow

                          AREA ||i.UpdateTxData1||, CODE, READONLY, ALIGN=2

                  UpdateTxData1 PROC
;;;157    ======================================================================== */
;;;158    void UpdateTxData1(void)
000000  2001              MOVS     r0,#1
;;;159    {
;;;160    //	 if(swt==1) tx_send1[6]|=0x01;
;;;161    //	 else tx_send1[6]&=0xfe;
;;;162    //	 if(swt1==1) tx_send1[6]|=0x02;
;;;163    //	 else tx_send1[6]&=0xfd;
;;;164    //	 if(AC_st==1) tx_send1[6]|=0x04;
;;;165    //	 else tx_send1[6]&=0xfb;
;;;166    	 tx_send1[7] = 1;//	
000002  4901              LDR      r1,|L11.8|
000004  71c8              STRB     r0,[r1,#7]
;;;167    }
000006  4770              BX       lr
;;;168    //按照低的来限制
                          ENDP

                  |L11.8|
                          DCD      tx_send1

                          AREA ||i.UpdateTxDataAMT||, CODE, READONLY, ALIGN=2

                  UpdateTxDataAMT PROC
;;;168    //按照低的来限制
;;;169    void UpdateTxDataAMT(void)
000000  b510              PUSH     {r4,lr}
;;;170    {
;;;171    	//todo：详细讲讲这个代码
;;;172        if(Acc_st==1)     //温油的会算出扭矩限制，查表一个扭矩限制，最终要取消输送给ECU
000002  4829              LDR      r0,|L12.168|
000004  7981              LDRB     r1,[r0,#6]  ; RCVData2
000006  79c0              LDRB     r0,[r0,#7]  ; RCVData2
000008  eb012000          ADD      r0,r1,r0,LSL #8
00000c  2801              CMP      r0,#1
00000e  d103              BNE      |L12.24|
;;;173    		trq[3]=225;
000010  20e1              MOVS     r0,#0xe1
000012  4926              LDR      r1,|L12.172|
000014  70c8              STRB     r0,[r1,#3]
000016  e046              B        |L12.166|
                  |L12.24|
;;;174        else
;;;175        {
;;;176             if(DRVDEM_TRQFLT_ENABLE)    //始终是使能的
;;;177             {
;;;178                if(Load_stCurr == Midload||Load_stCurr==Lowload)
000018  4825              LDR      r0,|L12.176|
00001a  7800              LDRB     r0,[r0,#0]  ; Load_stCurr
00001c  2802              CMP      r0,#2
00001e  d003              BEQ      |L12.40|
000020  4823              LDR      r0,|L12.176|
000022  7800              LDRB     r0,[r0,#0]  ; Load_stCurr
000024  2801              CMP      r0,#1
000026  d107              BNE      |L12.56|
                  |L12.40|
;;;179                {
;;;180                   TrqDrvFlt=(u8)CoEng_rDrvLoadFlt+125; //需求扭矩
000028  4822              LDR      r0,|L12.180|
00002a  6800              LDR      r0,[r0,#0]  ; CoEng_rDrvLoadFlt
00002c  f7fffffe          BL       __aeabi_f2uiz
000030  307d              ADDS     r0,r0,#0x7d
000032  4921              LDR      r1,|L12.184|
000034  7008              STRB     r0,[r1,#0]
000036  e002              B        |L12.62|
                  |L12.56|
;;;181                } 
;;;182    			else TrqDrvFlt = 255;
000038  20ff              MOVS     r0,#0xff
00003a  491f              LDR      r1,|L12.184|
00003c  7008              STRB     r0,[r1,#0]
                  |L12.62|
;;;183             } 
;;;184    		 else TrqDrvFlt = 255; //此举没有任何意义，永远也执行不到。
;;;185             if(TrqLoad < trqmax)  //限制小于最大值。
00003e  481f              LDR      r0,|L12.188|
000040  8800              LDRH     r0,[r0,#0]  ; trqmax
000042  f7fffffe          BL       __aeabi_ui2f
000046  4604              MOV      r4,r0
000048  481d              LDR      r0,|L12.192|
00004a  6801              LDR      r1,[r0,#0]  ; TrqLoad
00004c  4620              MOV      r0,r4
00004e  f7fffffe          BL       __aeabi_cfrcmple
000052  d216              BCS      |L12.130|
;;;186             {
;;;187                if(TrqLoad < TrqDrvFlt) trq[3] = TrqLoad;
000054  4818              LDR      r0,|L12.184|
000056  7800              LDRB     r0,[r0,#0]  ; TrqDrvFlt
000058  f7fffffe          BL       __aeabi_ui2f
00005c  4604              MOV      r4,r0
00005e  4818              LDR      r0,|L12.192|
000060  6801              LDR      r1,[r0,#0]  ; TrqLoad
000062  4620              MOV      r0,r4
000064  f7fffffe          BL       __aeabi_cfrcmple
000068  d206              BCS      |L12.120|
00006a  4815              LDR      r0,|L12.192|
00006c  6800              LDR      r0,[r0,#0]  ; TrqLoad
00006e  f7fffffe          BL       __aeabi_f2uiz
000072  490e              LDR      r1,|L12.172|
000074  70c8              STRB     r0,[r1,#3]
000076  e013              B        |L12.160|
                  |L12.120|
;;;188                else trq[3] = TrqDrvFlt;
000078  480f              LDR      r0,|L12.184|
00007a  7800              LDRB     r0,[r0,#0]  ; TrqDrvFlt
00007c  490b              LDR      r1,|L12.172|
00007e  70c8              STRB     r0,[r1,#3]
000080  e00e              B        |L12.160|
                  |L12.130|
;;;189             }
;;;190             else
;;;191             {
;;;192                if(trqmax < TrqDrvFlt) trq[3] = trqmax;
000082  480e              LDR      r0,|L12.188|
000084  8800              LDRH     r0,[r0,#0]  ; trqmax
000086  490c              LDR      r1,|L12.184|
000088  7809              LDRB     r1,[r1,#0]  ; TrqDrvFlt
00008a  4288              CMP      r0,r1
00008c  da04              BGE      |L12.152|
00008e  480b              LDR      r0,|L12.188|
000090  7800              LDRB     r0,[r0,#0]  ; trqmax
000092  4906              LDR      r1,|L12.172|
000094  70c8              STRB     r0,[r1,#3]
000096  e003              B        |L12.160|
                  |L12.152|
;;;193                else trq[3] = TrqDrvFlt;
000098  4807              LDR      r0,|L12.184|
00009a  7800              LDRB     r0,[r0,#0]  ; TrqDrvFlt
00009c  4903              LDR      r1,|L12.172|
00009e  70c8              STRB     r0,[r1,#3]
                  |L12.160|
;;;194             }
;;;195    		 trq[0]=35;
0000a0  2023              MOVS     r0,#0x23
0000a2  4902              LDR      r1,|L12.172|
0000a4  7008              STRB     r0,[r1,#0]
                  |L12.166|
;;;196        }
;;;197    }
0000a6  bd10              POP      {r4,pc}
;;;198    
                          ENDP

                  |L12.168|
                          DCD      RCVData2
                  |L12.172|
                          DCD      trq
                  |L12.176|
                          DCD      Load_stCurr
                  |L12.180|
                          DCD      CoEng_rDrvLoadFlt
                  |L12.184|
                          DCD      TrqDrvFlt
                  |L12.188|
                          DCD      trqmax
                  |L12.192|
                          DCD      TrqLoad

                          AREA ||i.calu||, CODE, READONLY, ALIGN=1

                  calu PROC
;;;352    
;;;353    long int calu(int x1, int x2, int y1, int y2, int x)
000000  b5f0              PUSH     {r4-r7,lr}
;;;354    {
000002  4604              MOV      r4,r0
000004  9d05              LDR      r5,[sp,#0x14]
;;;355    	long int y;
;;;356    	y = ((long)(y2-y1)*x+(long)y1*x2-(long)x1*y2)/(x2-x1);
000006  1a9e              SUBS     r6,r3,r2
000008  436e              MULS     r6,r5,r6
00000a  fb026601          MLA      r6,r2,r1,r6
00000e  fb046613          MLS      r6,r4,r3,r6
000012  1b0f              SUBS     r7,r1,r4
000014  fb96f0f7          SDIV     r0,r6,r7
;;;357    	return(y);
;;;358    }
000018  bdf0              POP      {r4-r7,pc}
;;;359    float SignalFlter(float x1, float yold, float ti) 
                          ENDP


                          AREA ||.bss||, DATA, NOINIT, ALIGN=2

                  RCVData
                          %        16
                  RCVData0
                          %        16
                  RCVData1
                          %        16
                  RCVData2
                          %        16
                  RCVData3
                          %        16
                  RCVData4
                          %        16
                  RCVData5
                          %        16
                  RCVData6
                          %        16
                  CoEng_r100msLoad
                          %        800
                  Eng_nAvg100ms
                          %        800
                  CoEng_rtrqInr100ms
                          %        200
                  CoEng_rDrvLoad100ms
                          %        100
                  Accped_r100ms
                          %        120

                          AREA ||.constdata||, DATA, READONLY, ALIGN=0

                  DataLenth
000000  00                DCB      0x00

                          AREA ||.data||, DATA, ALIGN=2

                  SystemTime250us
000000  00                DCB      0x00
                  SystemTime1ms
000001  00                DCB      0x00
                  SystemTime10ms
000002  00                DCB      0x00
                  SystemTime50ms
000003  00                DCB      0x00
                  SystemTime100ms
000004  00                DCB      0x00
                  SystemTime500ms
000005  00                DCB      0x00
                  SystemTime1s
000006  00                DCB      0x00
                  SystemTime3s
000007  00                DCB      0x00
                  B_TimeOut
000008  00                DCB      0x00
                  CL_stOutflag
000009  00                DCB      0x00
                  app1
00000a  00                DCB      0x00
                  app2
00000b  00                DCB      0x00
                  app3
00000c  00                DCB      0x00
                  numapp
00000d  00                DCB      0x00
                  appold1
00000e  00                DCB      0x00
                  appold2
00000f  00                DCB      0x00
                  appold3
000010  00                DCB      0x00
                  appold4
000011  00                DCB      0x00
                  appold5
000012  00                DCB      0x00
                  appold6
000013  00                DCB      0x00
                  CANerr_flg
000014  00                DCB      0x00
                  CANerr_state
000015  00                DCB      0x00
                  CANr1
000016  00                DCB      0x00
                  CANr2
000017  00                DCB      0x00
                  CANr3
000018  00                DCB      0x00
                  CANr4
000019  00                DCB      0x00
                  CANr5
00001a  00                DCB      0x00
                  CANr6
00001b  00                DCB      0x00
                  CANr7
00001c  00000000          DCB      0x00,0x00,0x00,0x00
                  App_rFreeze
                          DCD      0x00000000
                  App_rquit
                          DCD      0x00000000
                  Moffrm_trqMax
                          DCD      0x00000000
                  EngPrt_trqLim
                          DCD      0x00000000
                  CoEng_TrqFrc
                          DCD      0x00000000
                  CoEng_trq
                          DCD      0x00000000
                  EngPrt_trqNet
                          DCD      0x00000000
                  trqmax
00003c  0000              DCB      0x00,0x00
                  Load_stCurr
00003e  00                DCB      0x00
                  Load_stTarget
00003f  00                DCB      0x00
                  iout
000040  00                DCB      0x00
                  jout
000041  000000            DCB      0x00,0x00,0x00
                  App_dev
                          DCD      0x00000000
                  rdev
000048  00                DCB      0x00
                  mrdev
000049  00                DCB      0x00
                  Curr_trq
00004a  00                DCB      0x00
                  CAN7flag
00004b  00                DCB      0x00
                  CAN17flag
00004c  00000000          DCB      0x00,0x00,0x00,0x00
                  numCAN
                          DCD      0x00000000
                  flagCAN
                          DCD      0x00000000
                  trqmaxfloat
                          DCD      0x00000000
                  tx_send1
                          %        8
                  trq
                          %        8
                  fReceivedData
00006c  00                DCB      0x00
                  fReceivedData17
00006d  00                DCB      0x00
                  fReceivedData7
00006e  00                DCB      0x00
                  fCAN7OK
00006f  00                DCB      0x00
                  fCAN17OK
000070  00                DCB      0x00
                  fCANBUSOK
000071  00                DCB      0x00
                  CANBUSNUM
000072  00                DCB      0x00
                  CANbusClr
000073  00                DCB      0x00
                  Eng_nAvgSum
                          DCD      0x00000000
                  Coeng_rtrqInrSum
                          DCD      0x00000000
                  Coeng_rDrvLoadSum
                          DCD      0x00000000
                  Eng_nAvg20
                          DCD      0x00000000
                  Coeng_trqInrCurr
                          DCD      0x00000000
                  CoEng_rtrqInrAvg
                          DCD      0x00000000
                  CoEng_rDrvLoad
00008c  00000000          DCB      0x00,0x00,0x00,0x00
                  Accped_rSum
                          DCD      0x00000000
                  Accped_r3s
                          DCD      0x00000000
                  TrqlimLow
                          DCD      0x00000000
                  TrqlimMid
                          DCD      0x00000000
                  TrqLoad
                          DCD      0x00000000
                  CoEng_trqDrv10Load
                          DCD      0x00000000
                  fCanOK
0000a8  00                DCB      0x00
                  n
0000a9  00                DCB      0x00
                  nop
0000aa  00                DCB      0x00
                  ||swt||
0000ab  00                DCB      0x00
                  swt1
0000ac  00000000          DCB      0x00,0x00,0x00,0x00
                  Eng_nAvg
                          DCD      0x00000000
                  Eng_nAvgFlt
                          DCD      0x00000000
                  Eng_nAvgFltOld
                          DCD      0x00000000
                  Accped_r
                          DCD      0x00000000
                  Accped_rFlt
                          DCD      0x00000000
                  Accped_rFltOld
                          DCD      0x00000000
                  RateSpeed
                          DCD      0x00000000
                  CoEng_rCurLoad
                          DCD      0x00000000
                  CoEng_rAvg20Load
                          DCD      0x00000000
                  CoEng_rAvg3Load
                          DCD      0x00000000
                  CoEng_rDrv10Load
                          DCD      0x00000000
                  CoEng_rDrvLoadFlt
                          DCD      0x00000000
                  CoEng_rDrvLoadFltOld
                          DCD      0x00000000
                  CoEng_rSumLoad
                          DCD      0x00000000
                  CoEng_rSum3Load
                          DCD      0x00000000
                  Eng_nAvgplus
0000ec  0000              DCB      0x00,0x00
                  Eng_nAvgFltInt
0000ee  0000              DCB      0x00,0x00
                  CoEng_trqint
                          DCD      0x00000000
                  Accped_rint
                          DCD      0x00000000
                  Accped_rFltint
                          DCD      0x00000000
                  Num_ConstLim
0000fc  00                DCB      0x00
                  Num_LowLoad
0000fd  00                DCB      0x00
                  Num_MidLoad
0000fe  00                DCB      0x00
                  TrqDrvFlt
0000ff  00                DCB      0x00
                  CanErrCnt
000100  0096              DCW      0x0096
                  |symbol_number.44|
000102  0096              DCW      0x0096
                  |symbol_number.45|
000104  0096              DCW      0x0096
                  i
000106  00                DCB      0x00
                  j
000107  00                DCB      0x00
                  |symbol_number.48|
000108  00                DCB      0x00
                  inow
000109  00                DCB      0x00
                  TimerAPPCnt0
00010a  0000              DCB      0x00,0x00
                  APP_T0
00010c  00                DCB      0x00
